\documentclass[number-in-sections,a4paper]{notes}

\title{D-modules}
\subtitle{Lecture Notes}
\author{Clemens Koppensteiner}

\input{macros.tex}

\addbibresource{references.bib}

\begin{document}

\maketitle

\setcounter{tocdepth}{1}
\tableofcontents

\section{Introduction}

\subsection{Some references}

We will mainly follow the book \cite{HottaTakeuchiTanisaki:2008:DModulesPerverseSheavesRepresentationTheory}.
Other references include \cite{
Arkhipov:DModules,
Bernstein:AlgebraicTheoryOfDModules,
Bjoerk:1979:RingsOfDifferentialOperators,
Borel:1987:AlgebraicDModules,
BravermanChmutova:LecturesOnAlgebraicDModules,
Ginzburg:LecturesOnDmodules,
MaisonobeSabbah:Kaiserslautern,
Mebkhout:1989:LeFormalismeDesSixOperationsPourLesDModules,
}. Please be aware that some of these documents -- while undoubtedly very useful -- do occasionally contain errors.

\subsection{Warning}

These are work-in-progress lecture notes and hence will contain an above average amount of errors.
Please send any corrections to \href{mailto:clemens@koppensteiner.site}{clemens@koppensteiner.site}, or file them at the Github site for this document: \href{https://github.com/caramdir/D-modules}{https://github.com/caramdir/D-modules}.

\section{The ring of differential operators}

Unless otherwise mentioned, throughout this course $X$ will be a quasi-projective smooth complex variety.
Alternatively, many -- but not all -- of the results also hold for smooth analytic varieties.
We will write $\tb X$ for the tangent bundle of $X$ and $\ctb X$ for its cotangent bundle.
Both are locally free of rank $\dim  X$.
The tangent bundle $\tb X$ has a natural action on the ring of regular functions $\sO_X$ by differentiation.

\begin{Definition}
    The \emph{ring of differential operators} $\sD_X$ is subalgebra of $\sheafEnd_\CC(\sO_X)$ generated by $\sO_X$ and $\tb X$.
\end{Definition}

Thus, if one picks local coordinates $x_1,\dotsc,x_n$ of $X$, the sheaf $\sD_X$ is locally the free algebra generated by $x_1,\dotsc,x_n$ and $\partial_i = \frac{\partial}{\partial x_i}$, $1 \le i \le n$, subject to the relations
\begin{align*}
    [x_i,\, x_j] &= 0 \qquad  \text{for all $i$, $j$},\\
    [\partial_i,\, \partial_j] &= 0 \qquad \text{for all $i$, $j$},\\
    [\partial_i,\, x_i] &= 1 \qquad \text{for all $i$},\\
    [\partial_i,\, x_j] &= 0 \qquad \text{for all $i \ne j$}.
\end{align*}

The sheaf of $\CC$-algebras $\sD_X$ has a natural filtration $F_i\sD_X = \sD_X^{\le i}$ by degree of the differential operator.
In other words $F_0\sD_X = \sO_X$ and
\[
    F_{i+1}\sD_X = \bigl\{ \theta \in \sD_X : [\theta, f] \in F_i \sD_X \text{ for all $f \in \sO_X$} \bigr\}.
\]
The associated graded $\gr \sD_X$ is naturally identified with
\[
    \pi_*\sO_{T^*X} \cong \SymAlg_{\sO_X} \tb X.
\]

\begin{Corollary}
    $\sD_X$ is Noetherian of weak global dimension at most $2\dim X$.
\end{Corollary}

We can now introduce our main objects of study.

\begin{Definition}
    The abelian category of (left) $\sD_X$-modules (or \emph{D-modules} for short) is denoted by $\catDMod{X}$.
\end{Definition}

\begin{Examples}
    Clearly $\sD_X$ is a left module over itself.
    The structure sheaf $\sO_X \cong \sD_X / F_{\ge 1}\sD$ is a D-module with the usual action of differential operators on functions.

    Given any closed subvariety $Z$ defined by a sheaf of ideals $\sheaf I_Z$, we can consider the module $\sD_X/\sD_X\sheaf I_Z$.
    In particular, if $X = \as 1$ and $Z = \{0\}$ is the origin, $\sheaf M = \sheaf D_X/\sheaf D_X\sheaf I_Z$ is given by $\CC[\partial]$, where $x \in \sO_X$ acts on $\sheaf M$ by $x \cdot \partial^n = -n\partial^{n-1}$.
    This is the skyscraper D-module at the origin (one notes that the usual skyscraper $\sO$-module $\CC_0$ cannot be made into a D-module).
\end{Examples}

\begin{Example}
    Consider a differential operator $P \in \sD_X$ and the left D-module $\sheaf M = \sD_X/\sD_XP$.
    Then we have
    \begin{align*}
        \Hom_{\sD_X}(\sheaf M, \sO_X) & = \Hom(\sD_X/P\sD_X,\, \sO_X) \\
        & \cong \{ \varphi \in \Hom_{\sD_X}(\sD_X,\, \sO_X) : \varphi(P) = 0 \} \\
        & \cong \{ f \in \sO_X : Pf = 0 \},
    \end{align*}
    where the last isomorphism comes from the identification $\Hom_{\sD_X}(\sD_X, \sO_X) \cong \sO_X$, $\varphi \mapsto \phi(1)$: $Pf = P\varphi(1) = \varphi(P1) = \varphi(P) = 0$.
    Therefore D-modules know about solutions to differential equations.
\end{Example}
    
Given any integrable connection $\sheaf F \to \sheaf F \otimes \ctb X$, one dually obtains a map $\nabla\colon \tb X \to \sheafEnd_\CC(\sheaf F)$.
One checks that this can be upgraded to an action of $\sD_X$ on $\sheaf M$.
In fact, we can alternatively describe D-modules as integrable connections whose underlying $\sO_X$-modules are not required to be locally free.

\begin{Lemma}\label{lem:left_DMod_as_connection}
    Giving a left $\sD_X$-module structure on an $\sO_X$-module $\sheaf M$ is equivalent to giving a $\CC$-linear morphism
    \[
        \nabla\colon \tb X \to \sheafEnd_\CC(\sheaf M), \quad \theta \to \nabla_\theta
    \]
    such that the following conditions hold for all $\theta \in \tb X$, $f \in \sO_X$ and $s \in \sheaf M$:
    \begin{enumerate}
        \item $\nabla_{f\theta}(s) = f\nabla_{\theta}(s)$,
        \item $\nabla_\theta(fs) = \theta(f)s + f\nabla_\theta(s)$,
        \item $\nabla_{[\theta_1,\theta_2]}(s) = [\nabla_{\theta_1},\nabla_{\theta_2}](s)$.
    \end{enumerate}
\end{Lemma}

While one often prefers to work with left D-modules, we will see that many constructions are more natural to define for right D-modules.
We will write $\catrDMod{X}$ for the category or right $\sD_X$-modules.

\begin{Exercise}
    Give a description of right D-modules analogous to Lemma~\ref{lem:left_DMod_as_connection}.
\end{Exercise}

\begin{Example}
    We write $\canon_X = \bigwedge^{\dim X} \ctb X$ for the canonical line bundle on $X$.
    There exists a natural action of $\tb X$ on $\canon_X$ via the \emph{Lie derivative}:
    \[
        \Lie_\theta(\omega)(\theta_1,\dotsc,\theta_n) = \theta(\omega(\theta_1,\dotsc,\theta_n)) - \sum_{i=1}^{n} \omega(\theta_1, \dotsc, [\theta,\theta_i], \dotsc, \theta_n),
    \]
    for $\omega \in \canon_X$, $\theta_i \in \tb X$ and $n = \dim X$.
    This gives $\canon_X$ the structure of a right $\sD_X$-module by
    \[
        \omega\theta \coloneqq -\Lie_\theta(\omega).
    \]
\end{Example}

\begin{Lemma}\label{lem:tensor_module_struct}\label{lem:hom_module_struct}
    Let $\sheaf M,\, \sheaf M' \in \catDMod{X}$ and $\sheaf N,\, \sheaf N' \in \catrDMod{X}$.
    Then with $\theta \in \tb X$ one has the following module structures:
    \begin{align*}
        \sheaf M \otimes_{\sO_X} \sheaf M' &\in \catDMod{X},  & (m \otimes m')\theta & \coloneqq \theta m \otimes m' + m \otimes \theta m', \\
        \sheaf N \otimes_{\sO_X} \sheaf M &\in \catrDMod{X}, & (n \otimes m)\theta & \coloneqq n\theta \otimes m - n \otimes \theta m, \\
        \sheafHom_{\sO_X}(\sheaf M,\, \sheaf M') & \in \catDMod{X},   & (\theta\phi)(m) & \coloneqq \theta(\phi(m)) - \phi(\theta m), \\
        \sheafHom_{\sO_X}(\sheaf N,\, \sheaf N') & \in \catDMod{X},   & (\theta\phi)(n) & \coloneqq -\phi(n)\theta + \phi(n\theta), \\
        \sheafHom_{\sO_X}(\sheaf M,\, \sheaf N)  & \in \catrDMod{X}, & (\phi\theta)(m) & \coloneqq \phi(m)\theta + \phi(\theta m).
    \end{align*}
\end{Lemma}

\begin{Exercise}
    Show that there exists a canonical isomorphism 
    \[
        \sDop \cong \canon_x \otimes_{\sO_X} \sD_X \otimes_{\sO_X} \canon_{X}^\dual.
    \]
\end{Exercise}

\begin{Lemma}\label{lem:tensor_product_switching}
    Let $\sheaf M,\, \sheaf M' \in \catDMod{X}$ and $\sheaf N \in \catrDMod{X}$.
    Then there exist isomorphisms
    \[
        (\sheaf N \otimes_{\sO_X} \sheaf M') \otimes_{\sD_X} \sheaf M \cong
        \sheaf N \otimes_{\sD_X} (\sheaf M \otimes_{\sO_X} \sheaf M') \cong
        (\sheaf N \otimes_{\sO_X} \sheaf M) \otimes_{\sD_X} \sheaf M'.
    \]
\end{Lemma}

\begin{Lemma}
    The assignment
    \[
        \sheaf M \mapsto \canon_X \otimes_{\sO_X} \sheaf M
    \]
    extends to an equivalence of categories $\catDMod{X} \to \catrDMod{X}$ with quasi-inverse given by
    \begin{equation*}\label{eq:right_to_left}
        \sheaf N \mapsto \canon_X^\dual \otimes_{\sO_X} \sheaf N \coloneqq \sheafHom_{\sO_X}(\canon_X,\, \sheaf N).
    \end{equation*}
\end{Lemma}

We will frequently make use of this equivalence to freely switch between the perspectives of right and left modules.
This will be of particular importance in the next sections when we define various functors acting on D-modules.

\begin{Definition}
    The full subcategory of $\catDMod X$ consisting $\sO_X$-quasi-coherent D-modules is denoted by $\catDModqc{X}$.

    A $\sD_X$-module $\sheaf M$ is \emph{coherent} if its is locally finitely presented and for any open subset $U$ of $X$ any locally finitely generated submodule of $\res{\sheaf M}U$ is locally finitely presented.
    We write $\catDModcoh{X}$ for the corresponding full subcategory of $\catDMod X$.
\end{Definition}

\begin{Fact}\label{fact:coherent}
    A $\sD_X$-module is coherent if and only if it is $\sO_X$-quasi-coherent and locally finitely generated over $\sD_X$.
    In particular $\sD_X$ is coherent as a module over itself.
\end{Fact}

\begin{Fact}
    Any $\sO_X$-coherent $\sD_X$-module is locally free as an $\sO_X$-module (and finitely generated).
\end{Fact}

\begin{Definition}
    We write $\catDDMod{X}$ for the derived category of $\catDMod{X}$.
    We denote by $\catDDModqc{X}$ and $\catDDModcoh{X}$ the full subcategories of $\catDDMod{X}$ consisting of those complexes with cohomology sheaves in $\catDModqc{X}$ and $\catDModcoh{X}$ respectively.
    As usually we add a superscript $+$, $-$, or $b$ to indicated boundedness conditions.
\end{Definition}

\begin{Fact}
    The natural functors
    \[
        \catDb{\catDModqc{X}} \to \catDbDModqc{X}
    \]
    and
    \[
        \catDb{\catDModcoh{X}} \to \catDbDModcoh{X}
    \]
    are equivalences.
\end{Fact}


\section{Pushforward and pullback}

Given a morphism $f\colon X \to Y$ of smooth complex varieties, we want to define functors between the corresponding (derived) categories of D-modules.
It turns out that that the most natural functors to define actually go between the categories of \emph{right} D-modules.
It is however common to apply the side-switching operations and work with left modules instead, so we will also do so here.

\subsection{The transfer modules}

Let $f\colon X \to Y$ be a morphism of smooth complex varieties and let $\sheaf M$ be a left $\sD_Y$-module.
We note that there is a canonical $\sO_X$-module morphism $f^*\ctb Y \to \ctb X$.
Taking its dual, we obtain a canonical morphism
\[
    f'\colon \tb X \to f^*\tb Y.
\]
Using this we can endow the $\sO_X$-module
\[
    f^*\sheaf M = \sO_X \otimes_{f^{-1}\sO_Y} f^{-1}\sheaf M
\]
with the structure of a left $\sD_X$-module: given $\theta \in \tb X$ and $s \otimes m \in f^*\sheaf M = \sO_X \otimes_{f^{-1}\sO_Y} f^{-1}\sheaf M$ we set
\[
    \theta(s \otimes m) = \theta(s) \otimes m + s f'(\theta)(m),
\]
where for $f'(\theta) = \sum t_i \otimes \theta_i$ we set $sf'(\theta)(m) = \sum st_i \otimes \theta_i(m)$.

If $\sheaf M$ is also a right $\sD_Y$-module, then $f^*\sheaf M$ continues to be a right $f^{-1}\sD_Y$-module by the right action on $f^{-1}\sheaf M$.
In particular we obtain a $(\sD_X, f^{-1}\sD_Y)$-bimodule $f^*\sD_Y$.

Applying the side-switching operations, we also obtain an $(f^{-1}\sD_Y, \sD_X)$-bimodule
\[
    \canon_X \otimes_{\sO_X} f^*\sD_Y \otimes_{f^{-1}\sO_Y} f^{-1}\canon_Y^\dual.
\]


\begin{Definition}
    The bimodules
    \begin{align*}
        \sD_{X \to Y} & \coloneqq f^*\sheaf \sD_Y
        \shortintertext{and}
        \sD_{Y \from X} & \coloneqq  \canon_X \otimes_{\sO_X} \sD_{X \to Y} \otimes_{f^{-1}\sO_Y} f^{-1}\canon_Y^\dual
    \end{align*}
    are called the \emph{transfer bimodules.}
\end{Definition}

\begin{Exercise}\label{exc:closed_embedding_transfer_module}
    Consider the closed embedding $i\colon \as{n-k} \hookrightarrow \as n$ as the $x_{1} = \dots = x_k = 0$.
    Show that
    \[
        \sD_{\as{n-k} \to \as n} \cong \sD_{\as{n-k}} \otimes_\CC \CC[\partial_1,\dotsc,\partial_k]
    \]
    as a left $\sD_{\as{n-k}}$-module.
\end{Exercise}

\subsection{Pullback}

\begin{Definition}
    Define the \emph{pullback} (or \emph{inverse image}) functor
    \[
        f^!\colon \catDmDMod{Y} \to \catDmDMod{X}, \qquad f^!\sheaf M = \sD_{X \to Y} \Lotimes_{f^{-1}\sD_Y} f^{-1}\sheaf M[\dim X - \dim Y].
    \]
\end{Definition}

\begin{Remark}\label{rem:pushforward-via-Grothedieck-duality}
    Why the shift and why the notation $f^!$?
    Grothendieck duality gives a functor $f_{\sO}^!$ between categories of $\sO$-modules.
    It turns out that this functor is compatible with \emph{right} D-module structures.
    Thus we get a functor between left modules by applying the side-switching operations:
    \[
        \canon_X^\dual \Lotimes_{\sO_X} f_{\sO}^! \Lotimes_{f^{-1}\sO_Y} f^{-1}\canon_Y.
    \]
    However, since everything is smooth, we have isomorphisms
    \[
        f_{\sO}^!(-) \cong f_{\sO}^!\sO_X \Lotimes_{\sO_X} f^*(-) \cong
        \canon_{X/Y} \otimes f^*(-)[\dim X - \dim Y]
    \]
    and
    \[
        \canon_{X/Y} \cong \canon_X \otimes_{\sO_X} f^*\canon_Y^\dual \cong \canon_X \otimes_{f^{-1}\sO_Y} f^{-1}\canon_Y^\dual.
    \]
    Thus the canonical bundles cancel out and we are left with the definition above.

    Ultimately this choice will be justified by compatibility with the de Rham functor.
\end{Remark}

\begin{Remark}
    In \cite{HottaTakeuchiTanisaki:2008:DModulesPerverseSheavesRepresentationTheory}, the functor $f^!$ is denoted $f^\dagger$.
    In \cite{Bernstein:AlgebraicTheoryOfDModules}, the \enquote{naive pullback} $f^*$ is denoted $f^\Delta$, while in some other places it is also denoted $f^\dagger$.
\end{Remark}

\begin{Lemma}
    The functor $f^!$ restricts to a functor $\catDbDModqc Y \to \catDbDModqc X$.
\end{Lemma}

\begin{Remark}
    It does not however restrict to a functor $\catDbDModcoh Y \to \catDbDModcoh X$.
    For example, if $f\colon X \to Y$ is a non-trivial closed immersion, the pullback of $\sD_Y$ is not $\sD_X$-coherent: according to Exercise~\ref{exc:closed_embedding_transfer_module} it is a locally free $\sD_X$-module of infinite rank.
\end{Remark}

\begin{Exercise}
    Let $f\colon X \to Y$ and $g\colon Y \to Z$ be morphisms of smooth complex varieties.
    Show that $f^! \circ g^! \cong (g \circ f)^!$.
\end{Exercise}


\begin{Proposition}\label{prop:i^!-for-closed-immersion}
    Let $i\colon Z \hookrightarrow X$ be a closed embedding of smooth varieties and $\sheaf M \in \catDbDModqc{X}$.
    Then we have a canonical isomorphism
    \[
        i^!\sheaf M \cong \RsheafHom_{i^{-1}\sD_X}(\sD_{X \from Z},\, i^{-1}\sheaf M).
    \]
\end{Proposition}

\begin{proof}
    To simplify notation, we will show this for the corresponding functors of right modules.
    Applying tensor-Hom adjunction one has
    \begin{align*}
        \sheafRHom_{i^{-1}\sD_X}(\sD_{Z \to X},\, i^{-1}\sheaf M) & =
        \sheafRHom_{i^{-1}\sD_X}(\sO_Z \otimes_{i^{-1}\sO_X} i^{-1}\sD_X,\, i^{-1}\sheaf M) \\ &\cong
        \sheafRHom_{i^{-1}\sO_X}\bigl(\sO_Z,\, \sheafRHom_{i^{-1}\sD_X}( i^{-1}\sD_X,\, i^{-1}\sheaf M)\bigr) \\ &\cong
        \sheafRHom_{i^{-1}\sO_X}(\sO_Z,\, i^{-1}\sheaf M) \\&\cong
        i_{\sO}^!\sheaf M.
    \end{align*}
    To complete the proof, one needs to check that this identification is compatible with the D-module structures.
    Instead of doing so, we will give an explicit proof of the result via a Koszul-type resolution of $\sD_{X \from Z}$ in the exercises.
\end{proof}

Consider a product $X \times Y$ and let $p_1, p_2$ be the two projection maps.
For $\sheaf M \in \catDMod{X}$, $\sheaf N \in \catDMod{Y}$ define
\[
    \sheaf M \boxtimes \sheaf N \coloneqq \sD_{X \times Y} \mathop{\otimes}_{p_1^{-1}\sD_X \mathop{\otimes}\limits_\CC p_2^{-1}\sD_Y} (p_1^{-1}\sheaf M \mathop\otimes_\CC p_2^{-1}\sheaf N).
\]
The underlying $\sO_{X \times Y}$ of $\sheaf M \boxtimes \sheaf N$ is the same as the $\sO$-module box product of $\sheaf M$ and $\sheaf N$.
As $\boxtimes$ is exact in both arguments, it immediately extends to the derived categories.

\begin{Lemma}
    Let $\sheaf M, \sheaf N \in \catDbDMod{X}$.
    \begin{enumerate}
        \item Denote by $\Delta\colon X \to X \times X$ the diagonal morphism.
            Then $\sheaf M \Lotimes_{\sO_X} \sheaf N \cong \LL\Delta^*(\sheaf M \boxtimes \sheaf N)$.
        \item Let $f \colon Y \to X$ be a morphism.
            Then $\LL f^*(\sheaf M \Lotimes_{\sO_X} \sheaf N) \cong \LL f^*\sheaf M \Lotimes_{\sO_Y} \LL f^*\sheaf N$.
    \end{enumerate}
\end{Lemma}

\subsection{Pushforward}

Consider a right $\sD_X$-module $\sheaf N$.
Recall that the transfer module $\sD_{X \to Y}$ is a $(\sD_X, f^{-1}\sD_Y)$ bimodule.
Thus $\sheaf N \otimes_{\sD_X} \sD_{X \to Y}$ is a right $f^{-1}\sD_Y$-module.
We can therefore define a pushforward functor for \emph{right} D-modules
\[
    \sheaf N \mapsto f_*(\sheaf N \otimes_{\sD_X} \sD_{X \to Y}) \in \catrDMod Y.
\]
As one commonly works with \emph{left} D-modules, we use the transfer modules to obtain the corresponding functor for left D-modules
\[
    \sheaf M \mapsto \canon_Y^\dual \otimes_{\sO_Y} f_*( (\canon_X \otimes_{\sO_X} \sheaf M) \otimes_{\sD_X} \sD_{X \to Y} ).
\]
To make this a bit less unwieldy, we use Lemma~\ref{lem:tensor_product_switching} and the projection formula \cite[Exercise~\RomanNum{II}.5.1]{Hartshorne:AG} to rewrite the result as
\begin{align*}
    \canon_Y^\dual \otimes_{\sO_Y} f_*( (\canon_X \otimes_{\sO_X} \sheaf M) \otimes_{\sD_X} \sD_{X \to Y} ) & \cong
    \canon_Y^\dual \otimes_{\sO_Y} f_*( (\canon_X \otimes_{\sO_X} \sD_{X \to Y}) \otimes_{\sD_X} \sheaf M ) \\ &\cong
    f_*(f^{-1}\canon_Y^\dual \otimes_{f^{-1}\sO_X} \canon_X \otimes_{\sO_X} \sD_{X \to Y}) \otimes_{\sD_X} \sheaf M ) \\& \cong
    f_*(\sD_{Y \from X} \otimes_{\sD_{X}} \sheaf M).
\end{align*}
\begin{Definition}
    Define the \emph{pushforward} (or \emph{direct image}) functor
    \[
        f_\bullet\colon \catDbDMod{X} \to \catDbDMod{Y},\quad f_\bullet(\sheaf M) = \RR f_*(\sD_{Y \from X} \Lotimes_{\sD_X} \sheaf M).
    \]
\end{Definition}

We note that the definition of $f_\bullet$ contains a left-derived functor and a right derived functor, which can make it a bit tricky to handle.

\begin{Remark}
    In \cite{HottaTakeuchiTanisaki:2008:DModulesPerverseSheavesRepresentationTheory} and many other text the functor $f_\bullet$ is denoted by $\int_f$.
    One should be careful not to confuse $f_\bullet$ with the functor $f_*$ for plain sheaves (or $\sO$-modules).
    In particular, if $\pi\colon X \to \pt$ is the structure map, then $\pi_\bullet\sheaf M$ does not compute derived global sections.
    Rather, as we will see later, it will compute de Rham cohomology.
\end{Remark}

\begin{Exercise}
    Let $f\colon X \to Y$ and $g\colon Y \to Z$ be morphisms of smooth complex varieties.
    Show that $g_\bullet \circ f_\bullet \cong (g \circ f)_\bullet$.
\end{Exercise}


\begin{Example}
    If $j\colon U \hookrightarrow X$ is an open immersion, then $j^*\sD_X = j^{-1}\sD_X = \sD_U$.
    Hence $j_\bullet = \RR j_*$.
\end{Example}

\begin{Example}
    If $i\colon Z \hookrightarrow X$ is a closed immersion, then Exercise~\ref{exc:closed_embedding_transfer_module} shows that locally
    \[
        H^0(i_\bullet \sheaf M) \cong \CC[\partial_1,\dotsc,\partial_k] \otimes_\CC i_*\sheaf M
    \]
    and
    \[
        H^\ell(i_\bullet \sheaf M) = 0 \qquad \text{for } \ell \ne 0.
    \]
\end{Example}

\begin{Corollary}
    Let $i\colon Z \hookrightarrow X$ be a closed immersion.
    \begin{enumerate}
        \item For any $\sheaf M \in \catDMod{X}$ we have $H^\ell(i_\bullet \sheaf M)$ for $\ell \ne 0$.
            In particular 
            \[
                H^0(i_\bullet (-))\colon \catDMod{Z} \to \catDMod{X}
            \]
            is an exact functor.
        \item $i_\bullet$ restricts to a functor $\catDbDModqc{Z} \to \catDbDModqc{X}$.
    \end{enumerate}
\end{Corollary}

The following is a consequence of Proposition~\ref{prop:i^!-for-closed-immersion}.

\begin{Proposition}
    Let $i\colon Z \hookrightarrow X$ be a closed immersion.
    There exists a canonical isomorphism
    \[
        \sheafRHom_{\sD_X}(i_\bullet \sheaf M,\, \sheaf N) \cong \RR i_*\sheafRHom(\sheaf M,\, i^!\sheaf N).
    \]
    In particular $i^!$ is right adjoint to $i_\bullet$.
\end{Proposition}

\begin{Remark}
    Recall that for $\sO$-module functors, $f^*$ is \emph{left} adjoint to $f_*$, while if $f$ is proper, $f_{\sO}^!$ is \emph{right} adjoint to $f_\bullet$.
    Hence the notation $f^!$ for the D-module pullback is apt.
    We will later see that $f^!$ is right adjoint to $f_\bullet$ for any proper morphism $f$, at least on the coherent subcategories.
\end{Remark}

Next, we would like to compute $f_\bullet$ for a projection $f\colon X \times Y \to Y$.
To do so, we will start with the following lemma, which is useful in many situations.

\begin{Lemma}[Spencer resolution]\label{lem:spencer_resolution}
    Set $n = \dim X$.
    The complex
    \[
        0 \to
        \sD_{X} \otimes_{\sO_X} \bigwedge^n \tb X \to
        \dots \to
        \sD_{X} \otimes_{\sO_X} \bigwedge^0 \tb X \to
        \sO_X \to 0
    \]
    is a locally free resolution of the left $\sD_X$-module $\sO_X$.
    The complex
    \[
        0 \to
        \bigwedge^0 \ctb X \otimes_{\sO_X} \sD_X \to
        \dots \to
        \bigwedge^n \ctb X \otimes_{\sO_X} \sD_X \to
        \canon_X \to 0
    \]
    is a locally free resolution of the right $\sD_X$-module $\canon_X$.
\end{Lemma}

Let us describe the differentials:
\[
    \sD_{X} \otimes_{\sO_X} \bigwedge^0 \cong
    \sD_{X} \otimes_{\sO_X} \sO_X \cong
    \sD_X
    \to
    \sO_X
\]
is given by $P \mapsto P(1)$, and
\[
    d\colon \sD_{X} \otimes_{\sO_X} \bigwedge^k \tb X \to
    \sD_{X} \otimes_{\sO_X} \bigwedge^{k-1} \tb X
\]
is given by
\begin{multline*}
    d(P \otimes \theta_1 \wedge \dots \wedge \theta_k) = \\
    \sum_{i=0}^k (-1)^{i+1} P\theta_i \otimes \theta_1 \wedge \dots \wedge \widehat{\theta_i} \wedge \dots \wedge \theta_k + \sum_{i < j} (-1)^{i+j} P \otimes [\theta_i,\theta_j] \wedge \theta_i \wedge \dots \wedge \widehat{\theta_i} \wedge \dots \wedge \widehat{\theta_j} \wedge \dots \wedge \theta_k.
\end{multline*}
The map
\[
    \bigwedge^n \ctb X \otimes_{\sO_X} \sD_X \cong
    \canon_X \otimes_{\sO_X} \sD_X \to
    \canon_X
\]
is given by $\omega \otimes P \mapsto \omega P$ and the differential
\[
    d\colon \bigwedge^k \ctb X \otimes_{\sO_X} \sD_X \to
    \bigwedge^{k+1} \ctb X \otimes_{\sO_X} \sD_X
\]
is given in local coordinates $\{z_i, \partial_i\}$ by
\[
    d(\omega \otimes P) = d\omega \otimes P + \sum_i dz_i \wedge \omega \otimes \partial_i P.
\]

\begin{proof}[Proof of Lemma~\ref{lem:spencer_resolution}]
    The two complexes differ by the side-changing operations, so it suffices to prove that the first one is acyclic.
    Let $C$ be that complex and consider the following filtration:
    \[
        F_pC = \biggl[
            F_{p-n}\sD_{X} \otimes_{\sO_X} \bigwedge^n \tb X \to
            \dots \to
            F_p \sD_{X} \otimes_{\sO_X} \bigwedge^0 \tb X \to
            F_p \sO_X
        \biggr].
    \]
    It now suffices to show that the associated graded is acyclic (spectral sequence of a filtered complex).
    Let $\pi \colon T^*X \to X$ be the projection and $i\colon X \hookrightarrow T^*X$ the zero section.
    Then $\gr C \cong \pi_* D$ with
    \[
        D = \biggl[
            \sO_{T^*X} \otimes_{\pi^{-1}\sO_X} \bigwedge^n \pi^{-1}\tb X \to
            \dots \to
            \sO_{T^*X} \otimes_{\pi^{-1}\sO_X} \bigwedge^0 \pi^{-1}\tb X \to
            i_*\sO_X
        \biggr].
    \]
    But $D$ is just the Koszul resolution of the $\sO_{T^*X}$-module $i_*\sO_X$, and hence is acyclic.
    Since $\pi_*$ is affine, $\gr C$ and $C$ are also acyclic.
\end{proof}

Consider now a projection $f\colon X \times Y \to Y$ and let $\sheaf M \in \catDMod{X \times Y}$.
We note that $\sD_{Y \from X \times Y} = \canon_X \boxtimes \sD_Y$.
The Spencer resolution induces a locally free (and hence flat) resolution of $\sD_{Y \from X \times Y} \otimes_{\sD_{X \times Y}} \sheaf M$.
Set $\Omega_f^k = \Omega_X^k \boxtimes \sO_Y$.

\begin{Definition}
    The \emph{relative de Rham complex} of $\sheaf M$ is given by
    \[
        \DR_f(\sheaf M)^k =
        \begin{cases}
            \Omega_f^{k + \dim X} \otimes_{\sO_{X \times Y}} \sheaf M & -\dim X \le k \le 0 \\
            0 & \text{otherwise},
        \end{cases}
    \]
    with differential 
    \[
        d(\omega \otimes m) = d\omega \otimes m + \sum_{i=1}^{\dim X} (dz_i \wedge \omega) \otimes \partial_i s
    \]
    in local coordinates $\{z_i, \partial_i\}$ of $X$.
\end{Definition}

\begin{Corollary}
    Let $f\colon X \times Y \to Y$ be the projection.
    \begin{enumerate}
        \item For $\sheaf M \in \catDMod{X \times Y}$ we have $f_\bullet\sheaf M \cong \RR f_*(\DR_f(\sheaf M))$.
        \item The functor $f_\bullet$ restricts to a functor $\catDbDModqc{X \times Y} \to \catDbDModqc{Y}$.
    \end{enumerate}
\end{Corollary}

\begin{Remark}
    In particular, if $f\colon X \to \pt$ is the structure map, then $f_\bullet\sO_X$ computes the (algebraic) de Rham cohomology of $X$.
\end{Remark}

\begin{Corollary}
    Let $f\colon X \to Y$ be a morphism of smooth varieties.
    Then $f_\bullet$ restricts to a functor $\catDbDModqc{X \times Y} \to \catDbDModqc{Y}$.
\end{Corollary}

\begin{proof}
    We can always factor a morphism into a closed immersion (the graph of $f$) followed by a projection.
    We already know the statement for each of these cases.
\end{proof}

\subsection{Kashiwara's equivalence}

Consider a closed embedding $i \colon Z \hookrightarrow X$.
Denote by $\catDModqc{X}_Z$ the full subcategory of $\catDMod{X}$ consisting of D-modules which are (set-theoretically) supported on $Z$.
Similarly, denote by $\catDModcoh{X}_Z$ the corresponding subcategory of $\catDModcoh{X}$.

\begin{Theorem}[Kashiwara's Equivalence]\label{thm:KashiwarasEquivalence-abelian}
    Let $i\colon Z \hookrightarrow X$ be a closed immersion.
    \begin{enumerate}
        \item\label{it:thm:KashiwarasEquivalence:1}The functor $H^0i_\bullet$ induces an equivalence of categories
            \[
                \catDModqc{Z} \isoto \catDModqc{X}_Z,
            \]
            with quasi-inverse given by $H^0i^!$.
        \item\label{it:thm:KashiwarasEquivalence:2} This equivalence restricts to an equivalence
            \[
                \catDModcoh{Z} \isoto \catDModcoh{X}_Z.
            \]
        \item\label{it:thm:KashiwarasEquivalence:3} For any $\sheaf N \in \catDModqc{X}_Z$ one has $H^\ell i^!\sheaf N = 0$ for $\ell \ne 0$.
    \end{enumerate}
\end{Theorem}

\begin{proof}
    We already know that $H^\ell i_\bullet = 0$ for $\ell \ne 0$.
    We will first show \ref{it:thm:KashiwarasEquivalence:1} and \ref{it:thm:KashiwarasEquivalence:3}.
    By adjunction we have canonical maps
    \[
        \id \to H^0i^! \circ H^0i_\bullet
        \qquad\text{and}\qquad
        H^0i_\bullet \circ H^0i^! \to \id.
    \]
    To show \ref{it:thm:KashiwarasEquivalence:1}, we have to show that these are isomorphisms on the categories in question.
    This is a local statement.
    As \ref{it:thm:KashiwarasEquivalence:3} is also local, we may shrink $X$ as necessary.
    Further, by induction on the codimension of $Z$ in $X$, we may assume that $Z$ is a hypersurface.

    We can thus pick local coordinates $\{x_k, \partial_k \}$ on $X$ such that $Z$ is given by $\{x_1 = 0\}$.
    Set $z = x_1$ and $\partial = \partial_1$.

    For $\sheaf M \in \catDMod{Z}$ and $\sheaf N \in \catDMod{X}_Z$ we have
    \begin{align*}
        H^0i_\bullet\sheaf M &= \CC[\partial] \otimes_\CC i_*\sheaf M \\
        H^0i^!\sheaf N &= \ker(z\colon i^{-1}\sheaf N \to i^{-1}\sheaf N) \\
        H^1i^!\sheaf N &= \coker(z\colon i^{-1}\sheaf N \to i^{-1}\sheaf N) \\
        H^\ell i^!\sheaf N &= 0 \qquad \text{for $\ell \ne 0,\, 1$,}
    \end{align*}
    where the last three assertions follow by taking a free resolution of $\sD_{Z \to X} = \sD_X/\sD_Xz$.

    Consider now the \emph{Euler operator} $\theta = z\partial$ and form the eigenspaces
    \[
        \sheaf N^j = \{ s \in \sheaf N : \theta s = js \}
    \]
    By $[\partial, z] = 1$, we have $z\sheaf N^j \subseteq \sheaf N^{j+1}$ and $\partial \sheaf N^j \subseteq \sheaf N^{j-1}$.
    Clearly $\theta$ acts by multiplication by $j$ on $\sheaf N^j$ and thus is an isomorphism for $j \ne 0$.
    Thus $\partial z = \theta + 1\colon \sheaf N^j \to \sheaf N^j$ is an isomorphism for $j \ne -1$.
    It follows that for $j < -1$ we have isomorphisms
    \[
        z\colon \sheaf N^j \isoto \sheaf N^{j+1}
        \qquad\text{and}\qquad
        \partial\colon \sheaf N^{j+1} \isoto \sheaf N^{j}.
    \]
    We now claim that
    \begin{equation}\label{eq:thm:KashiwarasEquivalence:V-filtration}
        \sheaf N = \bigoplus_{j=1}^{\infty} \sheaf N^{-j}.
    \end{equation}
    By assumption, $\sheaf N$ is quasi-coherent as an $\sO_X$-module supported on $Z$, and hence every section $s$ of $\sheaf N$ is annihilated by $z^k$ for some sufficiently large $k$.
    Hence it suffices to show that
    \[
        \ker (z^k\colon \sheaf N \to \sheaf N) \subseteq \bigoplus_{j=1}^{k} \sheaf N^{-j}
    \]
    for all $k \ge 1$.
    We will induct on $k$.
    For $k = 1$ the condition $zs = 0$ implies that $\theta s = (\partial z - 1)s = -s$ and hence $s \in \sheaf N^{-1}$.

    Assume that $k \ge 2$ and let $s$ be a section of $\ker (z^k\colon \sheaf N \to \sheaf N)$.
    Then $0 = z^ks = z^{k-1}zs$ and by induction $zs \in  \bigoplus_{j=1}^{k-1} \sheaf N^{-j}$.
    It follows that 
    \[
        \theta s + s = z\partial s _ s = \partial z s \in \bigoplus_{j=2}^{k} \sheaf N^{-j}.
    \]
    We also have $z^{k-1}(\theta s + ks) = z^k \partial s +kz^{k-1}s = \partial z^k s = 0$.
    Again by induction we obtain
    \[
        \theta s + ks \in \bigoplus_{j=1}^{k-1} \sheaf N^{-j}.
    \]
    Taking the difference between these observations, we see that $(k-1)s \in \bigoplus_{j=1}^{k} \sheaf N^{-j}$, and, since $k \ge 2$, the same is true for $s$.
    We have thus shown \eqref{eq:thm:KashiwarasEquivalence:V-filtration}.

    Since $z\colon \sheaf N^j \to \sheaf N^{j+1}$ is an isomorphism for $j \le -2$, \eqref{eq:thm:KashiwarasEquivalence:V-filtration} immediately implies that
    \[
        H^0i^! = i^{-1}\sheaf N^{-1}
        \qquad\text\qquad
        H^1i^! = 0,
    \]
    showing \ref{it:thm:KashiwarasEquivalence:3}.
    Since also $\partial\colon \sheaf N^{j+1} \to \sheaf N^{j}$ is an isomorphism for $j \le -2$, \eqref{eq:thm:KashiwarasEquivalence:V-filtration} implies that
    \[
        \sheaf N \cong \CC[\partial] \otimes_{\CC} \sheaf N^{-1}.
    \]
    Statement \ref{it:thm:KashiwarasEquivalence:1} follows.

    It remains to show \ref{it:thm:KashiwarasEquivalence:2}.
    This is again a local problem.
    Locally, we have $H^0i_\bullet \sheaf M = \CC[\partial] \otimes_{\CC} i_*\sheaf M$, which is clearly finitely generated as a $\sD_X$-module.
    Conversely, let $\sheaf N \in \catDModcoh{X}_Z$.
    Writing $\sheaf N = \CC[\partial] \otimes_\CC \sheaf N^{-1}$, we see that there are finitely many generators $s_1,\dotsc,s_r \in \sheaf N^{-1}$ generating $\sheaf N$.
    Their images in $H^0i^!\sheaf N = i^{-1}\sheaf N^{-1}$ also generate.
\end{proof}

\begin{Remark}
    We saw in the proof that the Euler operator $z\partial$ only has negative integer eigenvalues on $\sheaf N$.
    The filtration $V_\bullet$ of $\sheaf N$ defined by $V_k\sheaf N = \sum_{j=-\infty}^k \sheaf N^j$ is called the \emph{Kashiwara--Malgrange V-filtration}.
    It exists more generally for $\sD_X$-modules which are not necessarily supported on $Z$, but the eigenvalues of $z\partial$ will usually not be integers.
    Nevertheless some of the basic properties we showed hold in more generality, and play an important role when understanding D-modules on compactifications (and hence in Hodge theory).
\end{Remark}

As usual, Theorem~\ref{thm:KashiwarasEquivalence-abelian} has a derived counterpart, which one obtains by induction on the cohomological length of a complex.
For this let $\catDbDModqc{X}_Z$ be the full subcategory of $\catDbDModqc{X}$ consisting of complexes $\sheaf M$ whose cohomology modules $H^\ell(\sheaf M)$ are contained in $\catDModqc{X}_Z$.
Define $\catDbDModcoh{X}_Z$ analogously.

\begin{Corollary}\label{thm:KashiwarasEquivalence-derived}
    Let $i\colon Z \hookrightarrow X$ be a closed immersion.
    Then the functor 
    \[
        i_\bullet \colon \catDbDModqc{Z} \to \catDbDModqc{X}_Z
    \]
    is a equivalence of triangulated categories with quasi-inverse given by $i^!$.
    This equivalence restricts to an equivalence
    \[
        i_\bullet \colon \catDbDModcoh{Z} \isoto \catDbDModcoh{X}_Z.
    \]
\end{Corollary}

\begin{Remark}
    Let us briefly discuss how to extend the theory of D-modules to singular varieties.
    Naively, we could consider the ring of differential operators on a singular variety and modules over that ring.
    However, in general this ring is badly behaved (for example not Noetherian \cite{BernsteinGelfandGelfand:1972:DifferentialOperatorsOnACubicCone}) and this definition would not give the expected answer.
    For example modules over that ring will not agree with the idea that D-modules are \enquote{sheaves with infinitesimal parallel transport}
    
    Thus we turn Kashiwara's equivalence into a definition.
    Namely, if $X$ is singular, choose a closed embedding $i\colon X \hookrightarrow Y$ into a smooth variety and define
    \[
        \catDModqc{X} = \catDModqc{Y}_X,
    \]
    and similarly for other categories of D-modules.
    This definition is independent of the choice of embedding: given another such embedding $i'\colon X \hookrightarrow Y'$, we can find a larger space $\tilde Y$ and embeddings $j\colon Y \hookrightarrow \tilde Y$ and $j'\colon Y' \hookrightarrow \tilde Y$ such that $j \circ i = j' \circ i'$.
    Then $\catDModqc{X} = \catDModqc{\tilde Y}_X$ by Kashiwara's Equivalence.
\end{Remark}

\subsection{Other useful identities}

\begin{Proposition}\label{prop:standard-triangle}
    Let $i\colon Z \hookrightarrow X$ be a closed immersion with open complement $j\colon U \hookrightarrow X$.
    Then for any $\sheaf M \in \catDbDModqc{X}$ there is a canonical distinguished triangle
    \[
        i_\bullet i^!\sheaf M \to \sheaf M \to j_\bullet j^!\sheaf M \xrightarrow{+1}.
    \]
    Further, for $\sheaf M \in \catDbDModqc{U}$ one has $i^!j_\bullet \sheaf M = 0$.
\end{Proposition}

\begin{Proposition}[Base change theorem]\label{prop:base-change}
    Consider a cartesian square
    \[
        \begin{tikzcd}
            Y_1 \times_X Y_2 \arrow[r,"\tilde g"] \arrow[d, "\tilde f"] & Y_1 \arrow[d,"f"] \\
            Y_2 \arrow[r, "g"] & X
        \end{tikzcd}
    \]
    of smooth varieties.
    Then there exists an isomorphism
    \[
        g^! f_\bullet \cong \tilde f_\bullet \tilde f^! \colon \catDbDModqc{Y_1} \to \catDbDModqc{Y_2}.
    \]
\end{Proposition}

\begin{Proposition}[Projection formula]
    Let $f\colon X \to Y$ be a morphism of smooth varieties.
    For $\sheaf M \in \catDbDModqc{X}$ and $\sheaf N \in \catDbDModqc{Y}$ there exists a canonical isomorphism
    \[
        f_\bullet(\sheaf M \Lotimes_{\sO_X} f^! \sheaf N) \cong f_\bullet\sheaf M \Lotimes_{\sO_Y} \sheaf N.
    \]
\end{Proposition}

\section{Coherent D-modules}

Recall that by Fact~\ref{fact:coherent} a D-module $\sheaf M \in \catDModqc{X}$ is coherent if and only if it is locally finitely generated.

\begin{Theorem}\label{thm:pushforward-of-coherent}
    Left $f\colon X \to Y$ be a proper morphism. Then $f_\bullet$ restricts to a functor
    \[
        f_\bullet\colon \catDbDModcoh{X} \to \catDbDModcoh{Y}.
    \]
\end{Theorem}

\begin{proof}
    It suffices to show that for $\sheaf M \in \catDModcoh{X}$ the direct image $f_\bullet\sheaf M$ has coherent cohomology sheaves.
    In the exercises we show that any such $\sheaf M$ has a bounded resolution $\mathrm{Sp}_k^\bullet$ consisting of D-modules of the form $\sD_X \otimes_{\sO_X} \sheaf F^j$ with $\sheaf F^j$ a coherent $\sO_X$-module.
    From the resulting spectral sequence
    \[
        H^i(f_\bullet(\sD_X \otimes_{\sO_X} \sheaf F^j)) \Rightarrow H^{i+j}(f_\bullet \sheaf M)
    \]
    we see that it suffices to show that $f_\bullet(\sD_X \otimes_{\sO_X} \sheaf F^j)$ has coherent cohomology sheaves.
    We have
    \begin{align*}
        f_\bullet(\sD_X \otimes_{\sO_X} \sheaf F^j) & =
        \RR f_*(\sD_{Y \from X} \Lotimes_{\sD_X} \sD_X \otimes_{\sO_X} \sheaf F^j) \\ & \cong
        \RR f_*(\sD_{Y \from X} \Lotimes_{\sO_X} \sheaf F^j) \\&\cong
        \RR f_*(f^{-1}(\sD_Y \otimes_{\sO_Y} \canon_Y^\dual) \Lotimes_{f^{-1}\sO_Y} \canon_X \otimes_{\sO_X} \sheaf F^j) \\&\cong
        \sD_Y \otimes_{\sO_Y} \canon_Y^\dual \Lotimes_{\sO_Y} \RR f_*(\canon_X \otimes_{\sO_X} \sheaf F^j).
    \end{align*}
    Since $f$ is proper, $f_*$ maps coherent $\sO_X$-modules to coherent $\sO_Y$-modules.
    Thus $f_*(\canon_X \otimes_{\sO_X} \sheaf F^j)$ has $\sO$-coherent cohomology modules, and consequently $f_\bullet(\sD_X \otimes_{\sO_X} \sheaf F^j)$ has $\sD$-coherent ones.
\end{proof}

\begin{Remark}
    If $f$ is not proper, then in general $f_\bullet$ does not preserve coherence.
    For example if $X$ is non-proper and $f\colon X \to \pt$ is the structure map, then $f_\bullet \sD_X \cong \RR\Gamma(X, \sO_X)$ which is not finitely generated.
\end{Remark}

\subsection{Duality}

Consider a D-module $\sheaf M$.
Then $\sheafHom_{\sD_X}(\sheaf M, \sD_X)$ naturally has the structure of a right $\sD_X$-module by right multiplication on $\sD_X$.
To obtain a left D-module we apply the side-changing operations.

\begin{Definition}
    Define the \emph{duality functor} $\DD \colon \catDmDMod{X} \to \oppcat{\catDpDMod{X}}$ by
    \[
        \DD\sheaf M = \RsheafHom_{\sD_X}(\sheaf M,\, \sD_X) \otimes_{\sO_X} \canon_X^\dual[\dim X].
    \]
\end{Definition}

\begin{Remark}
    The shift by the dimension of $X$ is simply a convenient choice, as the following examples show.
    One might also see it as a remnant of Grothendieck duality, where, as in Remark~\ref{rem:pushforward-via-Grothedieck-duality} the remainder of the dualizing complex $\canon_X[\dim X]$ gets cancelled by a side-changing operation.
\end{Remark}

\begin{Example}
    Consider $X = \as 1$.
    Let $P \in \sD_X$ and set $\sheaf M = \sD_X/\sD_XP$.
    Then there is a free resolution
    \[
        0 \to \sD_X \xrightarrow{\cdot P} \sD_X \to \sheaf M \to 0
    \]
    of $\sheaf M$.
    Consequently, we have 
    \[
        \sheafRHom_{\sD_X}(\sheaf M,\, \sD_X) \cong
        [\sD_X \xrightarrow{P\cdot} \sD_X]
    \]
    via the identification $\sheafHom_{\sD_X}(\sD_X,\sD_X) \cong \sD_X$.
    It follows that
    \begin{align*}
        \sheafExt^0_{\sD_X}(\sheaf M,\, \sD_X) &\cong \ker (\sD_X \xrightarrow{P\cdot} \sD_X) = 0 \\
        \sheafExt^1_{\sD_X}(\sheaf M,\, \sD_X) &\cong \coker (\sD_X \xrightarrow{P\cdot} \sD_X) = \sD_X/P\sD_X.
    \end{align*}
    Applying the shift (and switching back to left modules\footnote{The corresponding left module is $\sD_X/\sD_XP^*$, where $P^*$ is the formal adjoint to $P$: if $P = \sum_\alpha f_{\alpha}(\underline x) \partial^\alpha$, then $P^* = \sum_\alpha (-\partial)^\alpha f_{\alpha}(\underline{x})$.}), we see that $\DD(\sheaf M)$ is concentrated in cohomological degree $0$.
\end{Example}

\begin{Exercise}
    Let $\sheaf M$ be an integrable connection, i.e.~an $\sO_X$-coherent $\sD_X$-module.
    Show that
    \[
        \DD\sheaf M \cong \sheafHom_{\sO_X}(\sheaf M,\, \sO_X).
    \]
\end{Exercise}

\begin{Theorem}\label{thm:dualizing-complex}
    $\sD_X \otimes_{\sO_X} \canon_X^\dual$ is a dualizing complex on $\catDbDModcoh{X}$.
    Thus:
    \begin{enumerate}
        \item\label{it:thm:dualizing-complex:coh} $\DD$ preserves coherence,
        \item\label{it:thm:dualizing-complex:dim} $\sD_X \otimes_{\sO_X} \canon_X^\dual$ has finite injective dimension and hence $\DD$ restricts to $\catDbDModcoh{X} \to \oppcat{\catDbDModcoh{X}}$,
        \item\label{it:thm:dualizing-complex:dual} $\DD \circ \DD \cong \id_{\catDbDModcoh{X}}$.
    \end{enumerate}
\end{Theorem}

\begin{proof}
    Claim \ref{it:thm:dualizing-complex:coh} is clear. 
    Assertion \ref{it:thm:dualizing-complex:dim} is shown with filtered ring methods, see Corollary~\ref{cor:finite-inj-dim}.
    Let us show \ref{it:thm:dualizing-complex:dual}: we need to show that the canonical map
    \[
        \sheaf M \to \RsheafHom_{\sDop_X}\bigl(\RsheafHom_{\sD_X}(\sheaf M,\, \sD_X),\, \sD_X\bigr) \cong \DD^2\sheaf M
    \]
    is an isomorphism.
    This is a local question, so that we may assume that $X$ is affine.
    Resolving $\sheaf M$ by free modules, we see that it suffices to show that the statement holds for $\sheaf M = \sD_X$.
    This case is trivial.
\end{proof}


\subsection{Relations between functors}

Due to time constraints we will not be able to prove the following important theorems.

\begin{Lemma}\label{lem:hom-via-dual}
    For $\sheaf M \in \catDbDModcoh{X}$ and $\sheaf N \in \catDbDMod{X}$ there is a canonical isomorphisms
    \[
        \sheafRHom_{\sD_X}(\sheaf M,\, \sD_X) \Lotimes_{\sD_X} \sheaf N \cong
        \sheafRHom_{\sD_X}(\sheaf M,\, \sheaf N)
    \]
    and
    \begin{align*}
        \sheafRHom_{\sD_X}(\sheaf M\, \sheaf N) &\cong 
        (\canon_X \Lotimes_{\sO_X} \DD\sheaf M) \Lotimes_{\sD_X} \sheaf N[-\dim X] \\&\cong
        \canon_X \Lotimes_{\sD_X} (\DD\sheaf M \Lotimes_{\sO_X} \sheaf N)[-\dim X] \\&\cong
        \sheafRHom_{\sD_X}(\sO_X,\, \DD\sheaf M \Lotimes_{\sO_X} \sheaf N).
    \end{align*}
    in $\catD{\CC_X}$.
    In particular, if $p\colon X \to \pt$ is the structure map, one has
    \[
        \RHom_{\sD_X}(\sheaf M,\, \sheaf N) \cong p_\bullet(\DD\sheaf M \Lotimes_{\sO_X} \sheaf N)[-\dim X].
    \]
\end{Lemma}

\begin{Theorem}
    Let $f\colon X \to Y$ be a smooth morphism and $\sheaf M \in \catDbDModcoh{Y}$.
    Then $f^!\sheaf M \in \catDbDModcoh{X}$ and
    \[
        \DD_X(f^*\sheaf M) \cong f^*(\DD_Y \sheaf M),
    \]
    or equivalently
    \[
        \DD_X(f^!\sheaf M)[2\dim X] \cong f^!(\DD_Y \sheaf M)[2\dim Y].
    \]
\end{Theorem}

\begin{proof}[Idea of proof]
    One shows this more generally for \enquote{non-characteristic} morphisms, which can be decomposed (via the graph) into a closed immersion and a projection, both of which are again non-characteristic.
    These cases are dealt with by explicit computations.
\end{proof}

\begin{Theorem}\label{thm:duality}
    Let $f\colon X \to Y$ be a proper morphism.
    Then there is a canonical isomorphism
    \[
        f_\bullet \DD_X \isoto \DD_Y f_\bullet
    \]
    of functors $\catDbDModcoh{X} \to \oppcat{\catDbDModcoh{Y}}$.
\end{Theorem}

\begin{proof}[Idea of proof]
    One uses Grothendieck duality to construct a natural transformation between the two functors.
    To show that it is an isomorphism, one reduces to checking for $\sD_X$ and does an explicit computation.
\end{proof}

\begin{Theorem}\label{thm:proper-adjunction}
    Let $f\colon X \to Y$ be a proper morphism.
    Then there is an isomorphism
    \[
        \sheafRHom_{\sD_Y}(f_\bullet \sheaf M,\, \sheaf N) \cong \RR f_*\sheafRHom_{\sD_X}(\sheaf M,\, f^! \sheaf N)
    \]
    for $\sheaf M \in \catDbDModcoh{X}$ and $\sheaf N \in \catDbDMod{Y}$.
\end{Theorem}

\begin{proof}[Idea of proof]
    Using Lemma~\ref{lem:hom-via-dual}, one rewrites the $\RsheafHom$ as a tensor product and applies Theorem~\ref{thm:duality}.
\end{proof}

\section{Aside: Filtered rings}

We already noted that $\sD_X$ is a filtered sheaf of rings such that the associated graded $\gr \sD_X$ is commutative.
This fact can be used to deduce properties of $\sD_X$ from the easier to understand $\gr \sD_X \cong \pi_*\sO_{T^*X}$.
Moreover, we will see that coherent D-modules can be endowed with a \enquote{good} compatible filtration which encoded many of their properties.

In this section we will briefly outline some constructions and results about graded rings and their modules.
Useful references are \cite[Appendix~D]{HottaTakeuchiTanisaki:2008:DModulesPerverseSheavesRepresentationTheory} and \cite{Bjoerk:1979:RingsOfDifferentialOperators}.

\begin{Definition}\label{def:filtered-module}
    A \emph{filtered ring} $(A,F)$ is a ring $A$ together with collection $F_\ell A$, $\ell \in \ZZ_\ell$ of additive subgroups of $A$ such that
    \begin{enumerate}
        \item $F_\ell A = 0$ for $\ell < 0$,
        \item $1 \in F_0A$,
        \item $F_\ell A \subseteq F_{\ell+1}A$,
        \item $(F_\ell A)(F_mA) \subseteq F_{\ell+m}A$
        \item $\bigcup_\ell F_\ell A = A$.
    \end{enumerate}
    A \emph{filtered module} $(M,F)$ over $(A,F)$ is an $A$-module $M$ together with a collection $F_p M$, $p \in \ZZ$ of subgroups of $M$ satisfying
    \begin{enumerate}
        \item $F_p M \subseteq F_{p+1}M$,
        \item $(F_\ell A)(F_pM) \subseteq F_{p+\ell}M$,
        \item $\bigcup_p F_p M = M$.
    \end{enumerate}
    We will further always assume that $F_p M = 0$ for $p \ll 0$.
\end{Definition}
We set $\gr^F_\ell A = F_\ell A/F_{\ell-1}A$ and the \emph{associated graded} $\gr A = \bigoplus_\ell \gr_\ell^F A$.
It is a graded ring.
Similarly, we define the associated graded of a filtered $A$-module to obtain a graded $\gr A$-module $\gr M$.

\begin{Definition}
    Let $(A,F)$ be a filtered ring and $M$ an $A$-module.
    A filtration $F$ on $M$ is called \emph{good}, if $\gr_F M$ is a finitely generated $\gr A$-module.
\end{Definition}

\begin{Proposition}\label{prop:good-filtration}
    Let $(A,F)$ be a filtered ring and $M$ an $A$-module.
    The following are equivalent:
    \begin{enumerate}
        \item $M$ is a finitely generated $A$-module.
        \item There exists a good filtration on $M$.
    \end{enumerate}
    Furthermore, if $F$ and $G$ are two good filtrations on $M$ then for all $a \gg 0$ we have
    \[
        F_{p-a}M \subseteq G_pM \subseteq F_{p+a}M.
    \]
\end{Proposition}

\subsection{Dimensions}

\begin{Proposition}
    If $\gr A$ is a left (or right) noetherian ring, then so is $A$.
\end{Proposition}

\begin{Corollary}
    $\sD_X$ is left and right Noetherian.
\end{Corollary}

Let
\begin{equation}\label{eq:graded-ses}
    0 \to L \to M \to N \to 0
\end{equation}
be a short exact sequence of $A$-modules and assume that $M$ is endowed with a filtration $F$.
Then there are induced filtrations on $L$ and $N$ defined by
\[
    F_pL = F_pM \cap L
    \qquad\text{and}\qquad
    F_pN = \im(F_pM \to N).
\]
The corresponding associated graded modules fit into a short exact sequence
\[
    0 \to \gr L \to \gr M \to \gr N \to 0.
\]
If $(M,F)$ is good, then so is $(N,F)$.
If additionally $\gr A$ is left noetherian, then $(L,F)$ is also good.

Given two filtered $A$-modules $(M,F)$ and $(N,F)$ we define a filtration of the abelian group $\Hom_A(M,N)$ by
\[
    F_p\Hom_A(M,N) = \bigl\{f \in \Hom_A(M,N) : f(F_qM) \subset F_{q+p}N \text{ for all } q \in \ZZ\bigr\}.
\]
One has to be careful that the canonical homomorphism
\[
    \gr \Hom_A(M,N) \to \Hom_{\gr A}(\gr M,\, \gr N)
\]
is in general neither injective nor surjective.

\begin{Lemma}
    Assume that $\gr A$ is left noetherian and let $(M,F)$ be a good filtered $A$-module.
    Then there exists a good filtration on the right $A$-modules $\Ext_A^i(M,A)$ such that $\gr \Ext^i_A(M,N)$ is isomorphic to a subquotient of $\Ext^i_{\gr A}(\gr M,\, \gr A)$ as a right $\gr A$-module.
\end{Lemma}

\begin{Corollary}\label{cor:finite-inj-dim}
    $\sD_X$ has finite injective dimension.
\end{Corollary}

\begin{proof}
    As injective resolutions can be constructed locally, we can assume that $X$ is affine.
    It suffices to show that for sufficiently large $i$ one has $\Ext_{\sD_X}^i(\sheaf M, \sD_X) = 0$ for all $\sD_X$-modules $\sheaf M$.
    One can further restrict to $\sheaf M= \sD_X/I$ for all left ideals $I$ of $\sD_X$.
    Such $\sheaf M$ are clearly coherent.
    Because $\gr \sD_X = \sO_{T^*X}$ is smooth and has global dimension $2\dim X$, it follows that $\Ext_{\gr \sD_X}^i(\gr M,\, \gr\sD_X)$ vanishes for $i > 2\dim X$ independently of $M$.
    Thus also $\Ext_{\sD_X}^i(M,\,\sD_X)$ vanishes for $i > 2\dim X$.
\end{proof}

\begin{Theorem}
    Let $A$ be a filtered ring such that $\gr A$ is left (resp.~right) noetherian.
    Then the left (resp.~right) global dimension\footnote{I.e., the supremum of the set of projective dimensions of all left/right $A$-modules} of $A$ is at most the left (resp.~right) global dimension of $\gr A$.
\end{Theorem}

\begin{Corollary}
    The weak global dimension\footnote{I.e., the supremum of the set of weak(=flat) dimensions of all $\sD_X$-modules. Since $\sD_X$ is noetherian the left and right weak global dimensions coincide.} of $\sD_X$ is at most $2\dim X$.
\end{Corollary}

\subsection{Singular support}

From now on we assume that $\gr A$ is a commutative Noetherian ring.
For a good filtered $A$-module $(M,F)$ we can consider the support of its associated graded,
\[
    \supp(\gr^F M) \subseteq \Spec(\gr A),
\]
that is, those prime ideals $\ideal p \in \Spec(\gr A)$ such that $(\gr^F M)_{\ideal p} \ne 0$.

\begin{Lemma}
    The set $\supp(\gr^F M)$ does not depend on the choice of good filtration $F$ on $M$.
\end{Lemma}

\begin{Definition}
    For a finitely generated $A$-module $M$ and any good filtration $F$ on $M$ we call
    \[
        \SSupp(M) = \supp(\gr^F M) \subseteq \Spec(\gr A)
    \]
    the \emph{singular support} of $M$.
\end{Definition}

Given a short exact sequence
\[
    0 \to L \to M \to N \to 0
\]
of finitely generated $A$-modules the induced short exact sequence~\eqref{eq:graded-ses} implies that
\[
    \SSupp(M) = \SSupp(L) \cup \SSupp(N).
\]
Since $\gr A$ is commutative, we necessarily have $[F_pA, F_qA] \subseteq F_{p+q-1}A$.
We define a bracket 
\[
    \{-,-\}\colon \gr_p A \times \gr_q A \to \gr_{p+q-1} A, \quad \{ \overline{\vphantom{b}a}, \overline b\} = \overline{[a,b]},
\]
where $\overline{\vphantom{x}\cdot}$ is the projection to the quotient.
This bracket extends to a bi-additive \emph{Poisson bracket}
\[
    \{-,-\}\colon \gr A \times \gr A \to \gr A.
\]
Thus it has the following properties:
\begin{align*}
    \{a,b\} &= - \{b,a\}, \\
    \{\{a,b\},c\} + \{\{b,c\},a\} + \{\{c,a\},b\} &= 0, \\
    \{a, bc\} &= \{a,b\}c + b\{a,c\}.
\end{align*}
An ideal $\ideal a$ of $\gr A$ is called \emph{involutive} if $\{\ideal a,\ideal a \} \subseteq \ideal a$.

\begin{Example}\label{ex:poisson-symplectic}
    Consider a smooth (affine) variety $X$.
    Then the filtration on $\sD_X$ induces a bracket on $\sO_{T^*X}$.
    This bracket coincides with the Poisson bracket induced by the symplectic structure on $T^*X$.
    An ideal $\ideal a$ of $\sO_{T^*X}$ is involutive if and only if the corresponding closed subvariety of $T^*X$ is co-isotropic.
\end{Example}

\begin{Theorem}[Gabber's Theorem]\label{thm:Gabber}
    Assume that the center of $A$ contains a subring isomorphic to $\QQ$ and let $M$ be a finitely generated $A$-module.
    Then $J_M = \bigcap_{\ideal p \in \SSupp M} \ideal p$ is involutive.
\end{Theorem}

For a complex $M \in \catDbf{A}$ we set
\[
    \SSupp(M) = \bigcup_i \SSupp(H^i(M)).
\]

\begin{Proposition}\label{prop:ss-of-dual}
    Let $M \in \catDbf{A}$.
    Then 
    \[
        \SSupp(M) = \SSupp\bigl(\RHom_A(M,A)\bigr),
    \]
    where we take the second singular support in the category of $A^{\mathrm{op}}$-modules.
\end{Proposition}

Suppose now that in addition $\gr A$ is regular of pure dimension $m$.
For an finitely generated $A$-module $M$ let $d(m)$ be the dimension of its singular support, i.e.~the Krull dimension of $\gr A/J_M$, where as before $J_M = \bigcap_{\ideal p \in \SSupp(A)} \ideal p$.
The D-module version of the following theorem will be very useful in the next section.
It is deduced from the corresponding statements for commutative rings.
It states in which range the cohomology module of the dual of a given module lie, and gives an estimate on how big these cohomologies are.

\begin{Theorem}\label{thm:Ext-dim-estimates-ring}
    For a finitely generated $A$-module $M$ set
    \[
        j(M) = \min\bigl\{ i : \Ext_A^i(M,\, A) \ne 0 \bigr\}
    \]
    Then:
    \begin{enumerate}
        \item $j(M) + d(M) = m$,
        \item $d\bigl(\Ext^i_A(M,\, A)\bigr) \le m - i$,
        \item $d\bigl(\Ext^{j(M)}_A(M,\, A)\bigr) = d(M)$.
    \end{enumerate}
\end{Theorem}

\section{Characteristic varieties and holonomicity}

Let us apply the definitions from the last section to D-modules.
A filtration on a D-module $\sheaf M \in \catDModqc{X}$ is an increasing collection of $\sO_X$-quasi-coherent $\sO_X$-submodules $F_i\sheaf M$ of $\sheaf M$ satisfying conditions analogous to those of Definition~\ref{def:filtered-module}.
Such a filtration is \emph{good} if $\gr^F \sheaf M$ is coherent over $\gr \sD_X \cong \pi_*\sO_{T^*X}$.
We note that this is equivalent to the $F_i\sheaf M$ being $\sO_X$-coherent for each $i$ and the existence if $i_0 \in \ZZ$ satisfying
\[
    (F_j\sD_X)(F_i\sheaf M) = F_{i+j}\sheaf M \qquad \text{for all } j \ge 0,\, i \ge i_0.
\]
By Proposition~\ref{prop:good-filtration} every coherent $\sD_X$-module possesses local good filtrations.

\begin{Proposition}
    Let $X$ be a smooth (algebraic!) variety.
    A module $\sheaf M \in \catDModqc{X}$ is coherent if and only if it admits a global good filtration.
\end{Proposition}

\begin{Remark}
    This proposition does not hold in the analytic context: on an analytic variety not every coherent D-modules admits a global good filtrations.
    However, as Definition~\ref{def:holonomic} is local in nature, one can still define holonomicity.
    One can show that every holonomic D-module on a smooth analytic variety admits a global good filtration \cite[Theorem~\RomanNum{II}.3.1]{Malgrange:2004:OnIrregularHolonomicDModules}.
\end{Remark}

\begin{proof}
    If $\sheaf M$ admits a good filtration, then by Proposition~\ref{prop:good-filtration} it is locally finitely generated and hence coherent.
    Conversely, if $\sheaf M$ is coherent, then by Lemma~\ref{lem:coherent-global-generation} below there exists an $\sO$-coherent $\sO_X$-submodule $\sheaf F$ of $\sheaf M$ such that $\sD_X\sheaf F = \sheaf M$.
    The filtration defined by $F_i\sheaf M = (F_i\sD_X)\sheaf F$ is a global good filtration of $\sheaf M$.
\end{proof}

\begin{Lemma}\label{lem:coherent-global-generation}
    A coherent $\sD_X$-module (on a smooth algebraic variety) is globally generated by a coherent $\sO_X$-submodule.
\end{Lemma}

\begin{proof}
    Let $\sheaf M$ be $\sD_X$-coherent.
    Then it is locally finitely generated.
    Hence we can pick (finitely many!) open subsets $U_i$ of $X$ and coherent $\sO_X$-submodules $\sheaf F_i \subseteq \res{\sheaf M}{U_i}$ such that each $\res{\sheaf M}{U_i}$ is generated by $\sheaf F_i$.
    Pick coherent $\sO_X$-submodules $\widetilde{\sheaf F}_i$ of the quasi-coherent $\sO_X$-module $\sheaf M$ such that $\res{\widetilde{\sheaf F}_i}{U_i} = \sheaf F_i$ \cite[Exercise~\RomanNum{II}.5.15]{Hartshorne:AG}.
    Then $\sheaf M$ is generated by $\sum_i \widetilde{\sheaf F}_i$. 
\end{proof}

\begin{Definition}
    Let $\sheaf M$ be a coherent $\sD_X$-module endowed with a good filtration $F$.
    The support of the coherent $\sO_{T^*X}$-module
    \begin{equation}\label{eq:graded-on-cotangent}
        \sO_{T^*X} \otimes_{\pi^{-1}\pi_*\sO_{T^*X}} \pi^{-1}(\gr^F\sheaf M)
    \end{equation}
    is called the \emph{characteristic variety} (or sometimes \enquote{singular support}) of $\sheaf M$ and is denoted by $\Ch(\sheaf M)$.
\end{Definition}

As before, the characteristic variety does not depend on the choice of a good filtration on $\sheaf M$.
Since the $\sO_{T^*X}$-module~\eqref{eq:graded-on-cotangent} is graded, the characteristic variety is a conical (i.e., $\mathbb{G}_m$-equivariant) algebraic subset of $T^*X$.
For $\sheaf M \in \catDbDModcoh{X}$ we set 
\[
    \Ch(\sheaf M) = \bigcup_{i \in \ZZ} \Ch(H^i\sheaf M).
\]

\begin{Example}\leavevmode
    \begin{itemize}
        \item Clearly $\Ch(\sD_X) = T^*X$.
        \item If $\sheaf M$ is an integrable connection, then the two-step filtration
            \[
                F_i\sheaf M = \begin{cases} 0, & \text{if }i < 0, \\ \sheaf M & \text{if } i \ge 0 \end{cases}
            \]
            is good. Thus $\Ch(\sheaf M)$ is the zero section $X = T_X^*X$ in $T^*X$.
        \item Let $i\colon \{0\} \hookrightarrow \as 1$ and $\sheaf M = i_\bullet \CC = \CC[\partial]$.
            Then the degree filtration is good and hence $\Ch(\sheaf M) = \pi^{-1}(0) = T^*_{0}X$.
            \qedhere
    \end{itemize}
\end{Example}

\begin{Exercise}
    Let $\sheaf M$ be a coherent $\sD_X$-module with $\Ch(\sheaf M) \subseteq X = T^*_XX$.
    Show that $\sheaf M$ is an integrable connection.
\end{Exercise}

\begin{Exercise}\label{ex:closed_embedding_and_ch}
    Let $i\colon Z \hookrightarrow X$ be a closed embedding.
    Let
    \[  
        \begin{tikzcd}
            & i^*(T^*X) = Z \otimes_X T^*X \arrow[dl, "\rho"] \arrow[dr, "\varpi"] & \\
            T^*Z & & T^*X
        \end{tikzcd}
    \]
    be the natural morphisms induced by $i$.
    Let $\sheaf M$ be a coherent $\sD_Z$-module.
    Show that
    \[
        \Ch(i_\bullet \sheaf M) = \varpi(\rho^{-1}\Ch(\sheaf M)).
    \]
\end{Exercise}

\subsection{Dimension estimates}

Theorem~\ref{thm:Gabber} and Example~\ref{ex:poisson-symplectic} immediately imply that the characteristic variety of a coherent D-module is co-isotropic with respect to the natural symplectic structure on $T^*X$.
As a consequence we get the following dimension estimate (which can also be proven without resorting to Theorem~\ref{thm:Gabber}).

\begin{Theorem}[Bernstein's inequality]
    Let $\sheaf M$ be a coherent $\sD_X$-module.
    Then for any irreducible component $\Lambda$ of $\Ch(M)$ we have
    \[
        \dim \Lambda \ge \dim X.
    \]
    In particular any non-zero coherent $\sD_X$-module has a characteristic variety of dimension at least $\dim X$.
\end{Theorem}

Reformulating Proposition~\ref{prop:ss-of-dual} and Theorem~\ref{thm:Ext-dim-estimates-ring} for D-modules gives the following estimates.
\begin{Proposition}\label{prop:Ext-dim-estimates-ring}
    Let $\sheaf M$ be a coherent $\sD_X$-module.
    Then,
    \begin{enumerate}
        \item $\codim_{T^*X}\Ch(\sheafExt^i_{\sD_X}(\sheaf M,\, \sD_X)) \ge i$,
        \item $\sheafExt_{\sD_X}^i(\sheaf M, \sD_X) = 0$ for $i < \codim_{T^*X}\Ch(\sheaf M)$,
        \item $\dim \Ch(\RsheafHom(\sheaf M,\, \sD_X)) = \dim \Ch(\sheaf M)$.
    \end{enumerate}
\end{Proposition}

We note that the last statement only gives an upper bound for the characteristic variety of any particular cohomology module of $\DD\sheaf M$.
It follows that
\begin{enumerate}
    \item $H^i(\DD\sheaf M) = 0$ unless $-(\dim X-\codim_{T^*X}\Ch(\sheaf M)) \le i \le 0$,
    \item $\codim_{T^*X}\Ch(H^i(\DD\sheaf M)) \ge \dim X + i$,
    \item $\dim \Ch(\DD\sheaf M) = \dim \Ch(\sheaf M)$.
\end{enumerate}

\begin{Exercise}
    Show that for any affine open subset $U$ of $X$ the ring $\sD_X(U)$ has left and right global dimension $\dim X$.
    Deduce that any $\sheaf M \in \catDModqc{X}$ has a locally projective resolution of length at most $\dim X$.
\end{Exercise}

\subsection{Holonomic modules}

\begin{Definition}\label{def:holonomic}
    A coherent $\sD_X$-module $\sheaf M$ is called \emph{holonomic} of $\sheaf M = 0$ or $\dim \Ch(\sheaf M) = \dim X$.
    We write $\catDModhol{X}$ for the corresponding full subcategory of $\catDModcoh{X}$ and $\catDbDModhol{X}$ for the full subcategory of $\catDbDModcoh{X}$ consisting of complexes with holonomic cohomology modules.
\end{Definition}

\begin{Lemma}\label{lem:hol_thick_and_artinian}
    If
    \[
        0 \to \sheaf L \to \sheaf M \to \sheaf N \to 0
    \]
    is a short exact sequence of coherent $\sD_X$-modules, then $\sheaf M$ is holonomic if and only if $\sheaf L$ and $\sheaf N$ are holonomic.
    In other words $\catDModhol{X}$ is a thick subcategory of $\catDModcoh{X}$.

    Further, $\catDModhol{X}$ is artinian, i.e., every holonomic module satisfies the descending chain condition for submodules.
\end{Lemma}

\begin{proof}
    The first statement follows form $\Ch(\sheaf M) = \Ch(\sheaf N) \cup \Ch(\sheaf L)$.
    The second can be shown considering the characteristic cycle of a module, i.e., refining the characteristic variety with multiplicities.
\end{proof}

\begin{Fact}
    The natural functor
    \[
        \catDb{\catDModhol{X}} \to \catDbDModhol{X}
    \]
    is an equivalence.
\end{Fact}

From Proposition~\ref{prop:Ext-dim-estimates-ring} we immediately obtain the following statement.

\begin{Proposition}
    Let $\sheaf M \in \catDModcoh{X}$ be a coherent $\sD_X$-module.
    Then,
    \begin{enumerate}
        \item $\sheaf M$ is holonomic if and only if $H^i(\DD\sheaf M) = 0$ for $i \ne 0$.
        \item $\sheaf M$ is holonomic if and only of $\DD\sheaf M$ is holonomic.
    \end{enumerate}
\end{Proposition}

The following proposition is central in the study of holonomic D-modules as it allows for inductive arguments.

\begin{Proposition}\label{prop:generically-integrable-connection}
    Every holonomic $\sD_X$-module is generically an integrable connection.
    In other words, for every $\sheaf M \in \catDModhol{X}$ there exists a dense open subvariety $U$ of $X$ such that $\res{\sheaf M}{U}$ is $\sO_U$-coherent.
\end{Proposition}

\begin{proof}
    Set $S = \Ch(\sheaf M) \setminus T^*X_X$.
    Let $\pi \colon T^*X \to X$ be the projection.
    If $S$ is empty, then $\sheaf M$ is already $\sO_X$-coherent.
    Otherwise, since $\Ch(\sheaf M)$ is conical, each fiber of $\pi\colon S \to \pi(S)$ has dimension at least $1$.
    Thus, as $\sheaf M$ is holonomic, we have
    \[
        \dim \pi(S) \lneq \dim S \le \dim X.
    \]
    In follows that the complement of $\pi(S)$ must contain an open subset $U$.
    By construction $\res{\sheaf M}{U}$ is $\sO_U$-coherent.
\end{proof}

The following important result will be proven in the exercises.

\begin{Proposition}\label{prop:extension-of-holonomic}
    Let $\sheaf M \in \catDModqc{X}$ and let $U \subset X$ be open.
    Assume we are given a holonomic submodule $\sheaf N$ of $\res{\sheaf M}{U}$.
    Then there exists a holonomic submodule $\widetilde N$ of $\sheaf M$ such that $\res{\widetilde{\sheaf N}}{U} = \sheaf N$.
\end{Proposition}

\subsection{Preservation of holonomicity}

The goal of this subsection is to prove the following central theorem.

\begin{Theorem}\label{thm:preservation-of-holonomicity}
    Let $f\colon X \to Y$ be a morphism of smooth algebraic varieties.
    Then $f_\bullet$ and $f^!$ preserve the holonomicity.
    In other words these functors restrict to functors
    \[
        f_\bullet\colon \catDbDModhol{X} \to \catDbDModhol{Y}
    \]
    and
    \[
        f^!\colon \catDbDModhol{X} \to \catDbDModhol{X}.
    \]
\end{Theorem}

\begin{Example}
    Consider the open embedding $j\colon \as 1 \setminus \{0\} \hookrightarrow \as 1$.
    Then $\sheaf M = H^0(j_\bullet \sO_{\as 1 \setminus 0}) = \CC[x, x^{-1}]$.
    This is certainly not $\sO_X$-coherent.
    However, since $\frac{\partial}{\partial} x^{-n} = -nx^{-n-1}$, it is generated by $x^{-1}$ as a $\sD_X$-module, and hence at least coherent.
    In fact, we can filter $\sheaf M$ by the maximal appearing negative degree, so that $\Ch(\sheaf M) = T^*_XX \cup T^*_0X$.
\end{Example}

\begin{Remark}
    Theorem \ref{thm:preservation-of-holonomicity} does not hold for analytic D-modules.
    For example, consider again $j\colon \CC \setminus \{0\} \hookrightarrow \CC$.
    Then, the analytic structure sheaf $\sO_{\CC \setminus 0}$ contains all functions which have an isolated essential singularity at the origin.
    Thus the global sections of $\sO_{\CC \setminus 0}$ are not even finitely generated over $\sD_{\CC}$, which contains only regular functions.
\end{Remark}


The proof of this theorem is fairly involved.
Let us outline our plan of attack:
\begin{enumerate}
    \item[Step 1] Prove that $j_\bullet$ preserves holonomicity for locally closed immersions.
        As we already considered closed immersions, we only need to check open immersions.
        This is the hardest part of the proof.
    \item[Step 2] Proof of the theorem for $f^!$, using the first step via the standard triangle of Proposition~\ref{prop:standard-triangle}.
    \item[Step 3] Use the result of step 2 to give a stalk-wise characterization of holonomic modules.
    \item[Step 4] Use base change (Proposition~\ref{prop:base-change}) and step 3 to show that $f_\bullet$ preserves holonomicity whenever $f$ is proper, finishing up the proof.
\end{enumerate}

\subsubsection*{Step 1: Direct image along locally closed immersions}

From Exercise~\ref{ex:closed_embedding_and_ch} we deduce that $i_\bullet$ preserves holonomicity when $i$ is a closed immersion.
It remains to consider an open immersion $j\colon U \hookrightarrow X$.

\begin{Lemma}\label{lem:j_*holonomic}
    Let $j\colon U \to X$ be an open immersion and $\sheaf M \in \catDbDModhol{U}$.
    Then $j_\bullet \in \catDbDModhol{X}$.
\end{Lemma}

\begin{Example}
    Strikingly, this is something specific to \emph{holonomic} D-modules.
    The image under $j_\bullet$ of a general \emph{coherent} D-module does not need to be coherent.
    For example, let $j\colon \as 1 \setminus 0 \hookrightarrow \as 1$.
    Then $j_\bullet \sD_{\as 1\setminus 0}$ is not finitely generated over $\sD_{\as 1}$.
\end{Example}

\begin{proof}
    As usual we can reduce to $\sheaf M \in \catDModhol{X}$:
    For any $\sheaf M \in \catDbDModhol{X}$ let $\ell \in \ZZ$ be the smallest integer such that $H^\ell(\sheaf M) \ne 0$.
    Then we get a distinguished triangle
    \[
        H^\ell(\sheaf M)[\ell] \to \sheaf M \to \tau_{> n}\sheaf M
    \]
    and hence
    \[
        j_\bullet H^\ell(\sheaf M)[\ell] \to j_\bullet \sheaf M \to j_\bullet \tau_{> n}\sheaf M.
    \]
    As $\tau_{> n}\sheaf M$ has less non-zero cohomology modules than $\sheaf M$, we can use induction to assume that $j_\bullet \tau_{> n}\sheaf M \in \catDbDModhol{X}$.
    But $\catDbDModhol{X}$ is a thick subcategory of $\catDbDModqc{X}$ (i.e. if any two sheaves in a distinguished triangle are in $\catDbDModhol{X}$, then so is the third), so $j_\bullet\sheaf M \in \catDbDModhol{X}$.

    Further, as $\Ch(j_\bullet \sheaf M)$ can be computed locally, we can assume that $X$ is affine.
    Next we cover $U$ by finitely many distinguished opens $X_{f_i} = \{ f_i \ne 0 \}$.
    The direct image $i_\bullet\sheaf M = i_*\sheaf M$ is then isomorphic to the ech complex with entries
    \[
        \check C^k(\sheaf M) = \bigoplus_{i_0 < \dots < i_k} j_{i_0,\dots,i_k *}(\res{\sheaf M}{X_{i_0,\dots,i_k}}),
    \]
    where $X_{i_0,\dots,i_k} = \bigcap_{\ell = 0}^k X_{f_{i_\ell}}$, and $j_{i_0,\dots,i_k}$ is the corresponding inclusion.
    Iteratively we are thus reduced to $X$ being affine and $U = X_f$ for some $f \in \sO_X$.
    In thus case $j_\bullet = j_*$ is an exact functor.

    Any holonomic module is coherent and hence finitely generated.
    By Lemma~\ref{lem:hol_thick_and_artinian} we can thus assume that $\sheaf M$ is generated by a single section $u \in \sheaf M$.
    Thus the $\sD_X$-module $j_\bullet\sheaf M$ is generated by the sections $f^nu$ for $n \in \ZZ$.
    To show that $j_\bullet$ is coherent, it therefore suffices to show that
    \[
        f^nu \in \sD_X(f^{n+1}u) \subseteq j_\bullet\sheaf M
    \]
    for all $n \ll 0$.
    This immediately follows from the following lemma.

    \begin{Lemma}[Lemma on $b$-functions]\label{lem:b-functions}
        Let $X$ be affine, $U = X_f$ a distinguished open subset, $\sheaf M \in \catDModhol{U}$ and $u \in \sheaf M$.
        For a formal variable $s$ there exists a non-zero polynomial $b \in \CC[s]$ and a differential operator $A(s) \in \sD_X[s]$ such that
        \[
            A(n)(f^{n+1}u) = b(n) f^{n}u
        \]
        for all $n \in \ZZ$.
    \end{Lemma}

    \begin{proof}
        We base-change to the field of rational functions $\CC(s)$.
        Note that while we have always used $\CC$ as the ground field in these notes, all results about algebraic D-modules equally apply to any algebraically closed field of characteristic $0$.
        Thus it makes sense to speak of D-modules over $\CC(s)$.

        Denote by $\widehat U = U \times_{\Spec \CC} \Spec \CC(s)$ and $\widehat X = X \times_{\Spec \CC} \Spec \CC(s)$ the corresponding extensions of scalars.
        For any D-module $\sheaf N$ on $X$ or $U$ we can consider the module $\widehat{\sheaf N} = \sheaf N(s)$ on $\widehat X$ or $\widehat U$.
        Consider the module $\widehat{\sheaf M}f^s$ which has sections $mf^s$ with $m \in \widehat{\sheaf M}$ and $f^s$ a fixed formal symbol.
        The action of $\theta \in \sD_{\widehat U}$ in $\widehat{\sheaf M}f^s$ is defined as
        \[
            \theta(mf^s) = \theta(m)f^s + sm\frac{\theta(f)}{f}f^s.
        \]
        We note that for any $b \in \ZZ$ we have an evaluation maps $\widehat{\sheaf M}f^s \to \sheaf M$ sending $s$ to $n$ and $f^s$ to $f^n$.

        A good filtration on $\sheaf M$ induces one on $\widehat{\sheaf M}f^s$, so that
        \[
            \Ch(\widehat{\sheaf M}f^s) =
            \Ch(\widehat{\sheaf M}) =
            \widehat{\Ch(\sheaf M)} \subseteq
            \widehat{T^*U} =
            T^*\widehat{U}
        \]
        and $\widehat{\sheaf M}f^s$ is holonomic.

        Let $j\colon \widehat U \hookrightarrow \widehat X$ be the inclusion and set $\sheaf N = j_\bullet \widehat{\sheaf M}f^s$.
        By Proposition~\ref{prop:extension-of-holonomic} there exists a holonomic submodule $\sheaf N'$ of $\sheaf N$ such that $\res{\sheaf N'}{\widehat U} = \widehat{\sheaf M}f^s$.
        We note that the quotient $\sheaf N/\sheaf N'$ is supported on $\widehat Z =  \widehat X \setminus \widehat U$.
        
        Consider the section $uf^s$ on $\sheaf N$.
        Its image in $\sheaf N/\sheaf N'$ is supported on $\widehat Z$ and hence annihilated by some power of $f$.
        In other words, there exists some $k_0$ such that $uf^{k_0}f^s \in \sheaf N'$.
        Moreover  $\sheaf N'$ is holonomic, and hence artinian, so that the descending chain of submodules
        \[
            \sheaf N' \supseteq
            \sD_X(mf^{k_0}f^s) \supseteq
            \sD_X(mf^{k_0+1}f^s) \supseteq
            \dots
        \]
        stabilizes, i.e.
        \[
            \sD_X(mf^{K}f^s) =
            \sD_X(mf^{K+1}f^s).
        \]
        In particular, there exists a differential operator $\tilde A(s) \in \sD_{\widehat X}$ such that
        \[
            mf^{K}f^s = \tilde A(s)mf^{K+1}f^s.
        \]
        Writing $\tilde A(s) = \frac{A(s)}{b(s)}$ for $A(s) \in \sD_X[s]$ and $b(s) \in \CC[s]$, we obtain
        \[
            mf^{K}f^s = \frac{A(s)}{b(s)}mf^{K+1}f^s.
        \]
        We can replace $s$ by $s-K$ everywhere, so that
        \[
            mf^{s} = \frac{A(s)}{b(s)}mf^{s+1}.
        \]
        Multiplying by $b(s)$ and evaluating $s$ at $n$ we obtain the desired equation.
    \end{proof}

    Returning to the proof of Lemma~\ref{lem:j_*holonomic}, we have thus shown that $j_\bullet\sheaf M$ is coherent.
    It remains to show that it is indeed holonomic.
    We use the notation of the proof of Lemma~\ref{lem:b-functions}.
    Then the action of $f$ on $\sheaf N$ is invertible.
    In particular, the action of $f$ on $\sheaf N/\sheaf N'$ cannot be nilpotent and hence $j_\bullet \widehat{\sheaf M}f^s = \sheaf N = \sheaf N'$ is holonomic.

    \begin{Exercise}
        Let $\sheaf M$ be generated by a single section $u$.
        Then there exists finitely many differential operators $A_1,\dots,A_k$ such that $\sheaf M \cong \sD_X/(A_1,\dots,A_k)$.
        Let $\sigma_i$ be the image of $A_i$ under the canonical map $\sD_X \to \gr \sD_X$.
        Show that $\Ch(\sheaf M) = \{\sigma_1 = \dots = \sigma_k = 0\}$.
    \end{Exercise}

    Write $\sheaf N = \sD_{\widehat X}/(\widehat A_1(s), \dots, \widehat A_k(s))$ with $\widehat A_k(s) (uf^s) = 0$.
    For generic $n$ we can substitute $n$ for $s$, to obtain operators $\widehat A_i(n)$ annihilating $uf^n$.
    The common zeros of the images of $\widehat A_i(n)$ in $\gr \sD_X$ continue to have dimension at most $\dim X$.
    Thus the submodule of $j_\bullet\sheaf M$ generated by $uf^n$ is holonomic.
    But for $n \ll 0$ all of $j_\bullet\sheaf M$ is generated by $uf^n$, and thus is holonomic.
\end{proof}

\subsubsection*{Step 2: Pullback}

Factoring $f$ as a closed immersion followed by a projection, it suffices to check that $f^!$ preserves the holonomic subcategories in these two cases.

For a projection $f\colon X \times Y \to Y$, we have $f^! = f^*[\dim X]$ and $f^*$ is exact with $f^*\sheaf N = \sO_X \boxtimes \sheaf N$.
We have
\[
    \Ch(f^*\sheaf N) = \Ch(\sO_X \boxtimes \sheaf N) = \Ch(\sO_X) \times \Ch(\sheaf N) = T^*X_X \times \Ch(\sheaf N).
\]
Therefore, if $\sheaf N$ is holonomic, so is $f^!\sheaf N$.

Let now $i\colon Z \to X$ be a closed embedding with open complement $j\colon U \hookrightarrow X$.
Then by Proposition~\ref{prop:standard-triangle} we have a distinguished triangle
\[
    i_\bullet i^! \sheaf N \to \sheaf N \to j_\bullet j^!\sheaf N.
\]
If $\sheaf N$ is holonomic, then we already proved that also $j_\bullet j^!\sheaf N = j_\bullet(\res{\sheaf N}{U})$ is holonomic.
Hence so is $i_\bullet i^! \sheaf N$.
From Exercise~\ref{ex:closed_embedding_and_ch} it immediately follows that $i^!\sheaf N$ has to be holonomic too.

\subsubsection*{Step 3: A criterion for holonomicity}

\begin{Lemma}
    Let $\sheaf M \in \catDModcoh{X}$ be a coherent $\sD_X$-module.
    Then there exists a dense open subset $U$ of $X$ such that $\res{\sheaf M}{U}$ is projective as an $\sO_X$-module.
\end{Lemma}

\begin{proof}
    Choose a good filtration $F$ on $\sheaf M$.
    Then $\gr \sheaf M$ is coherent over $\pi_*\sO_{T^*X}$.
    Thus by \cite[Lemma~6.9.2]{EGA4.2} there exists a dense open subset $U$ of $X$ such that $\res{\gr \sheaf M}U$ is free over $\sO_U$.
    Since $\gr\sheaf M = \bigoplus F_i\sheaf M/F_{i-1}\sheaf M$, each $\res{F_i\sheaf M/F_{i-1}\sheaf M}U$ (and hence each $\res{F_i\sheaf M}U$) is projective over $\sO_U$.
    Thus $\res{\sheaf M}U$ is projective over $\sO_U$.
\end{proof}

\begin{Proposition}\label{prop:local_hol_criterion}
    Let $\sheaf M \in \catDbDModcoh{X}$ be a coherent $\sD_X$-module.
    Then $\sheaf M$ is a holonomic complex if and only $i_x^!\sheaf M$ is finite dimensional over $\CC$ for all (closed) points $x \in X$, where $i_x\colon \{x\} \hookrightarrow X$ is the inclusion.
\end{Proposition}

\begin{proof}
    We have already shown that if $\sheaf M$ is holonomic, then $i_x^!\sheaf M \in \catDbDMod{\pt}$ is holonomic, and hence a finite dimensional vector space.

    To show the reverse implication we induct on the dimension of $\supp \sheaf M$.
    As usual, we can assume that $\sheaf M \in \catDModcoh{X}$.
    If it is zero, then we are immediately done by Kashiwara's equivalence.
    Otherwise we can find an open dense subvariety $U$ of $\supp\sheaf M$ such that $\res{\sheaf M}U$ is projective as an $\sO_U$-module.
    Thus the functor $i_x^*$ is exact on $\res{\sheaf M}U$, and by assumption each $i_x^*\res{\sheaf M}{U}$ is finite dimensional.
    Thus $\res{\sheaf M}{U}$ has to be locally free of finite rank, and hence coherent over $\sO_U$.
    In particular it is holonomic.

    Let $j\colon U \hookrightarrow X$ be the inclusion and define $\sheaf N$ by the distinguished triangle
    \[
        \sheaf N \to \sheaf M \to j_\bullet j^!\sheaf M.
    \]
    By the above and Lemma~\ref{lem:j_*holonomic}, $j_\bullet j^!\sheaf M$ is holonomic, and hence in particular coherent.
    Thus $\sheaf N$ is coherent, and by base-change its fibers coincide with those of $\sheaf M$ outside of $U$ (note that $i_x^!j_* = 0$ for $x \notin U$).
    Thus by induction $\sheaf N$ is holonomic, and hence so is $\sheaf M$.
\end{proof}

\subsubsection{Step 4: Direct image along general morphisms}

It only remains to show that $f_\bullet(\catDbDModhol{X}) \subseteq \catDbDModhol{Y}$ for any $f\colon X \to Y$.
We already know this for locally closed immersions.
Using Hironaka desingularisation, it remains to prove it for $f$ proper.
We will apply Proposition~\ref{prop:local_hol_criterion}
For any $y \in Y$ consider the cartesian square
\[
    \begin{tikzcd}
        X_y \arrow[r, "\tilde\imath_y" ] \arrow[d, "\tilde f"] & X \arrow[d, "f"] \\
        \{y\} \arrow[r, "i_y"] & Y
    \end{tikzcd}
\]
By base-change we have $i_y^!f_\bullet \sheaf M \cong \tilde f_\bullet \tilde \imath^! \sheaf M$.
By Step 2, $\tilde \imath^! \sheaf M$ is holonomic, and hence in particular coherent.
By Theorem~\ref{thm:pushforward-of-coherent}, so is $\tilde f_\bullet \tilde \imath^! \sheaf M$.
Hence it is a complex of finite dimensional vector spaces.
This is true for any $y \in Y$, proving that $f_\bullet \sheaf M$ is holonomic.

This finishes the proof of Theorem~\ref{thm:preservation-of-holonomicity}.

\subsection{Six functors}

\begin{Definition}
    For a morphism $f\colon X \to Y$ define functors
    \[
        f^\bullet = \DD_Y \circ f^! \circ \DD_X \colon \catDbDModhol{Y} \to \catDbDModhol{X}
    \]
    and
    \[
        f_! = \DD_X \circ f_\bullet \circ \DD_Y \colon \catDbDModhol{X} \to \catDbDModhol{Y}.
    \]
\end{Definition}

\begin{Remark}
    Again, there exist a few notational variation is the literature.
    For example \cite{HottaTakeuchiTanisaki:2008:DModulesPerverseSheavesRepresentationTheory} use $f^{\scalebox{1.5}{\star}}$ and $\int_{f!}$, while \cite{Bernstein:AlgebraicTheoryOfDModules} uses $f^*$ instead of $f^\bullet$.
\end{Remark}

Similar to Theorem~\ref{thm:proper-adjunction} one obtains the following adjunction statements.

\begin{Theorem}\label{thm:adjunctions}
    For $f\colon X \to Y$, $\sheaf M \in \catDbDModhol{X}$ and $\sheaf N \in \catDbDModhol{Y}$ there are natural isomorphisms
    \[
        \RsheafHom_{\sD_Y}(f_!\sheaf M,\, \sheaf N) \cong \RR f_* \RsheafHom_{\sD_X}(\sheaf M,\, f^!\sheaf N)
    \]
    and
    \[
        \RR f_* \RsheafHom_{\sD_X}(f^\bullet\sheaf M,\, \sheaf N) \cong \RsheafHom_{\sD_Y}(\sheaf M,\, f_\bullet\sheaf N).
    \]
    In particular, $(f^\bullet, f_\bullet)$ and $(f_!,f^!)$ are adjoint pairs of functors.
\end{Theorem}

\begin{Theorem}
    For any $f\colon X \to Y$, there exists a canonical morphism of functors
    \[
        f_! \to f_\bullet\colon \catDbDModhol{X} \to \catDbDModhol{Y}.
    \]
    If $f$ is proper then this morphism is an isomorphism.
\end{Theorem}

\begin{proof}[Idea of proof]
    Using Hironaka desingularization we can factor $f$ into a locally closed embedding followed by a proper projection.
    For proper morphisms we already have a canonical isomorphism $f_! \cong f_\bullet$ (Theorem~\ref{thm:duality}).
    It remains to construct one for an open embedding $j$ (and to show that the resulting morphism is independent of the choice of smooth compactification).
    By adjunction we have
    \[
        \Hom(j_!\sheaf M,\, j_\bullet \sheaf M) \cong
        \Hom(\sheaf M,\, j^!j_\bullet \sheaf M) \cong
        \Hom(\sheaf M,\, \sheaf M).
    \]
    Thus the desired morphism $j_!\sheaf M \to j_\bullet \sheaf M$ is the image of $\id_{\sheaf M}$ under this identification.
\end{proof}

\iffalse

\begin{itemize}
    \item characteristic variety and pushforward (closed immersion, proper map -> Kashiwara's estimate)
    \item Preservation of holonomicity (b-functions? Koszul duality?)
    \item dual functors
    \item Minimal extensions and indecomposables.
\end{itemize}


\section{The de Rham and solution functors}

\begin{itemize}
    \item analytification
    \item de Rham and solution functors
    \item constructibility (algebraic case?)
\end{itemize}

\section{Regularity}

\begin{itemize}
    \item Definition
    \item Preserved by functors
\end{itemize}

\section{Riemann--Hilbert correspondence}

\begin{itemize}
    \item Statement
    \item Outline of proof in the algebraic setting
    \item Perverse sheaves
\end{itemize}

\fi
\appendix

\section{Derived categories}
Let $\cat A$ be an abelian category.
Homological algebra tells us that we should look at the category of complexes $\catComplexes{\cat A}$, but of course this category isn't quite the right thing to look at.
For example we want to identify homotopic morphisms.
But before we do that let us introduce some additional structure.

Firstly, we have a shift endofunctor: $A^\bullet[1] = A^{\bullet + 1}$ with differential multiplied by $(-1)$.

Second, given a morphism of complexes $f\colon A^\bullet \to B^\bullet$ we can form the cone \[
    \cone(f) = A^\bullet[1] \oplus B^\bullet
\]
with differential given by $\begin{psmallmatrix}d_A[1] & 0 \\ f & d_B\end{psmallmatrix}$:
\[
    \begin{tikzcd}[column sep=large, row sep=small]
        \cdots \arrow[r, "-d_A^{n-1}"] \arrow[ddr, "f^{n-1}" description]
        &
        A^{n} \arrow[r, "-d_A^{n}"] \arrow[ddr, "f^n" description] 
        &
        A^{n+1} \arrow[r, "-d_A^{n+1}"] \arrow[ddr, "f^{n+1}" description]
        &
        A^{n+2} \arrow[r, "-d_A^{n+2}"] \arrow[ddr, "f^{n+2}" description]
        &
        \cdots
        \\
        & \oplus & \oplus & \oplus & \\
        \cdots \arrow[r, "d_B^{n-2}"]
        &
        B^{n-1} \arrow[r, "d_B^{n-1}"]
        &
        B^{n} \arrow[r, "d_B^{n}"]
        &
        B^{n+1} \arrow[r, "d_B^{n+1}"]
        &
        \cdots
    \end{tikzcd}
\]
We obtain a triangle of morphisms
\[
    \begin{tikzcd}[column sep=small]
        & A \arrow[dr, "f"] & \\
        \cone(f) \arrow[ur, "+1"] & & B \arrow[ll]
    \end{tikzcd}
\]
Recall that two morphisms of complexes $f,g\colon A \to B$ are homotopic if there exits a collection of maps $h^\bullet\colon A^\bullet \to B^{\bullet-1}$ such that $f-g = d_Bh + hd_A$.
In this case we write $f \sim g$.
\[
    \begin{tikzcd}[column sep=large, row sep=large]
        \cdots \arrow[r, "d_A^{n-2}"]
        &
        A^{n-1} \arrow[r, "d_A^{n-1}"] \arrow[dl, dashed, "h^{n-1}" description] \arrow[d, shift right, "f^{n-1}"'] \arrow[d, shift left, "g^{n-1}"]
        &
        A^{n} \arrow[r, "d_A^{n}"] \arrow[dl, dashed, "h^{n}" description] \arrow[d, shift right, "f^{n}"'] \arrow[d, shift left, "g^{n}"]
        &
        A^{n+1} \arrow[r, "d_A^{n+1}"] \arrow[dl, dashed, "h^{n+1}" description] \arrow[d, shift right, "f^{n+1}"'] \arrow[d, shift left, "g^{n+1}"]
        &
        \cdots \arrow[dl, dashed, "h^{n+2}" description]
        \\
        \cdots \arrow[r, "d_B^{n-2}"]
        &
        B^{n-1} \arrow[r, "d_B^{n-1}"]
        &
        B^{n} \arrow[r, "d_B^{n}"]
        &
        B^{n+1} \arrow[r, "d_B^{n+1}"]
        &
        \cdots
    \end{tikzcd}
\]
We write $\catHomotopy{\cat A}$ for the homotopy category of complexes, i.e.~the category with the same objects as $\catComplexes{\cat A}$ and with morphisms
\[
    \Hom_{\catHomotopy{\cat A}}(A^\bullet,B^\bullet) = \rquot{\Hom_{\catComplexes{\cat A}}(A^\bullet,B^\bullet)}{\sim}.
\]
We call any triangle $X \to Y \to Z \to X[1]$ which is isomorphic to a triangle $X \xrightarrow{f} Y \to \cone(f) \to X[1]$ in $\catHomotopy{\cat A}$ a \emph{distinguished triangle}.
The shift functor and the collection distinguished triangles give $\catHomotopy{\cat A}$ the structure of a \emph{triangulated category}.
Thus it is an additive category and satisfies the following axioms.

\begin{enumerate}[label=(\textsc{tr}$_\arabic*$)]
    \item\label{tr1}
        For any object $X$, the triangle $X \xrightarrow{\id} X \to 0$ is distinguished.
        For any morphism $f\colon X \to Y$ there exists a distinguished triangle $X \xrightarrow{f} Y \to Z$ ($Z$ is called a \emph{mapping cone of $f$}).
        Any triangle that is isomorphic to a distinguished triangle is distinguished.
    \item\label{tr2}
        If $X \xrightarrow{f} Y \xrightarrow{g} Z \xrightarrow{h} X[1]$ is distinguished, then so are the rotated triangles
        \[
            Y \xrightarrow{g} Z \xrightarrow{h} X[1] \xrightarrow{-f[1]} Y[1]
            \quad\text{and}\quad
            Z[-1] \xrightarrow{-h[-1]} X \xrightarrow{f} Y \xrightarrow{g} Z.
        \]
    \item\label{tr3}
        Given two triangles and maps $f$ and $g$ which make the left-most square in the diagram below commute, there exists a (not necessarily unique) morphism $h$ making everything commute
        \[
            \begin{tikzcd}
                X \arrow[r] \arrow[d, "f"] & Y \arrow[r] \arrow[d, "g"] & Z \arrow[r] \arrow[d, dashed, "h"] & X[1] \arrow[d, "{f[1]}"] \\
                X' \arrow[r] & Y' \arrow[r] & Z' \arrow[r] & X'[1]
            \end{tikzcd}
        \]
    \item\label{tr4} The octahedral axiom.
        Given maps $f\colon X \to Y$ and $g\colon Y \to Z$ the mapping cones of $f$, $g$ and $gf$ fit into a distinguished triangle $\cone(f) \to \cone(gf) \to \cone(g)$, so that all possible diagrams commute.
        (These diagrams can be drawn in the shape of an octagon.)
\end{enumerate}

Note that it follows from \ref{tr3} that any two mapping cones of a morphism $f$ are isomorphic, but not necessarily uniquely so.
In particular, a morphism $f$ is an isomorphism if and only if $\cone(f) = 0$.
We also note that $\catComplexes{\cat A}$ does not satisfy \ref{tr1}, as the cone of the identity morphism is only null-homotopic, but not isomorphic to zero.

A functor between triangulated categories $F\colon \cat S \to \cat T$ together with an isomorphism $\phi\colon F \circ [1] \cong [1] \circ F$ is called \emph{exact} (or \emph{triangulated}) if it is additive and sends distinguished triangles to distinguished triangles.

A morphism of complexes is called a \emph{quasi-isomorphism} if it induces an isomorphism on cohomology.
We want to identify quasi-isomorphic objects and thus formally invert all quasi-isomorphisms.

\begin{Def}
    The derived category $\catD{\cat A}$ of $\cat A$ has the same objects as $\catHomotopy{\cat A}$ and morphisms $X \to Y$ in $\catD{\cat A}$ are roofs
    \[
        \begin{tikzcd}
            & C \arrow[dl, "\mathclap{\mathrm{quis}}", sloped, "\mathclap{a}"'] \arrow[dr, "\mathclap{b}", sloped] & \\
            A & & B
        \end{tikzcd}
    \]
    where $a$ is a homotopy class of a quasi-isomorphism $C \to A$ and $b$ is a homotopy class of a morphism $C \to B$.

We write $\catDp{\cat A}$, $\catDm{\cat A}$ and $\catDb{\cat A}$ for the full subcategories of $\catD{\cat A}$ consisting of objects $X \in \catD{\cat A}$ such that $H^i(X) = 0$ for all $i \ll 0$, resp.~all $i \gg 0$, resp.~all $i$ with $|i| \gg 0$.
\end{Def}

There exists a natural quotient functor $\catHomotopy{\cat A} \to \catD{\cat A}$.
We declare any triangle which is isomorphic to the image of a distinguished triangle under this morphism (i.e., to a triangle of the form $X \xrightarrow{f} Y \to \cone{f}$) to be a distinguished triangle in $\catD{\cat A}$.
This gives $\catD{\cat A}$ the structure of a triangulated category.
The same is true for the various bounded versions, which are full triangulated subcategories of $\catD{\cat A}$.

If $F\colon \cat A \to \cat B$ is a left exact functor we define its \emph{right derived functor} $RF\colon \catDp{\cat A} \to \catDp{\cat B}$ by $RF(X) = F(I)$, where $I$ is a complex consisting of injective objects with a quasi-isomorphism $X \isoto I$ and $F(I)$ is to be understood component-wise.
Similarly, we define the \emph{left derived functor} $LF\colon \catDm{\cat A} \to \catDm{\cat B}$ of a right exact functor $F$ as $F(P)$ for a projective resolution $P \isoto X$.

In particular, we obtain a bifunctor $R\Hom(-,-)$.

\begin{Exercise}
    Let $A = k[\epsilon]/(\epsilon^2)$ be the dual numbers.
    Show that in $\catDb{\catModules{A}}$ the complexes $0 \to k \xrightarrow{0} k \to 0$ and $0 \to A \xrightarrow{\epsilon} A \to 0$ are not quasi-isomorphic, despite having isomorphic cohomology modules.
    [Hint: Compute the endomorphism rings of the second complex. Note that this is easy to do since it is a bounded complex of projective $A$-modules. Deduce that it is indecomposable.]
    % https://math.stackexchange.com/questions/2145334/counterexample-in-the-derived-category?rq=1
\end{Exercise}

The above assumes that the category has enough injectives and projectives respectively.
For categories of sheaves this is not always the case.
Thus one uses $F$-injective (resp.~$F$-projective) complexes (see for example \cite[Theorem~10.5.9]{Weibel:1996:IntroductionToHomologicalAlgebra}.
For example, we can compute the derived tensor product $\otimes^L$ with a flat (e.g.~locally free) resolution.

\begin{Warning}
    The above only applies to the appropriately bounded derived category.
    Unbounded derived categories can behave in unexpected ways.
    For example the complex
    \[
        \cdots \ZZ/4 \xrightarrow{2} \ZZ/4 \xrightarrow{2} \ZZ/4 \cdots
    \]
    is an acyclic complex, i.e.~it is quasi-isomorphic to the zero complex in $\catD{\catModules{\ZZ/4}}$.
    But while the complex consists of free modules, it cannot be used to compute the derived tensor product:
    tensoring the complex with $\ZZ/2$ gives
    \[
        \cdots \ZZ/2 \xrightarrow{0} \ZZ/2 \xrightarrow{0} \ZZ/2 \cdots,
    \]
    which is not acyclic.
\end{Warning}

\printbibliography

\end{document}
